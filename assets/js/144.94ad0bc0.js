(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{356:function(a,t,s){"use strict";s.r(t);var e=s(0),r=Object(e.a)({},(function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("blockquote",[s("p",[a._v("专栏原创出处："),s("a",{attrs:{href:"https://github.com/GourdErwa/review-notes/tree/master/language/java-jvm",target:"_blank",rel:"noopener noreferrer"}},[a._v("github-源笔记文件 "),s("OutboundLink")],1),a._v(" ，"),s("a",{attrs:{href:"https://github.com/GourdErwa/java-advanced/tree/master/java-jvm",target:"_blank",rel:"noopener noreferrer"}},[a._v("github-源码 "),s("OutboundLink")],1),a._v("，欢迎 Star，转载请附上原文出处链接和本声明。")])]),a._v(" "),s("p",[a._v("Java JVM-虚拟机专栏系列笔记，系统性学习可访问个人复盘笔记-技术博客 "),s("a",{attrs:{href:"https://review-notes.top/language/java-jvm/",target:"_blank",rel:"noopener noreferrer"}},[a._v("Java JVM-虚拟机 "),s("OutboundLink")],1)]),a._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#前言"}},[a._v("前言")])]),s("li",[s("a",{attrs:{href:"#outofmemoryerror-相关异常"}},[a._v("OutOfMemoryError 相关异常")]),s("ul",[s("li",[s("a",{attrs:{href:"#java-堆内存溢出"}},[a._v("Java 堆内存溢出")])]),s("li",[s("a",{attrs:{href:"#字符串常量池溢出"}},[a._v("字符串常量池溢出")])]),s("li",[s("a",{attrs:{href:"#方法区出现内存溢出-metaspace-或者-permgen-space"}},[a._v("方法区出现内存溢出 Metaspace 或者 PermGen space")])]),s("li",[s("a",{attrs:{href:"#创建线程导致内存溢出-unable-to-create-native-thread"}},[a._v("创建线程导致内存溢出 unable to create native thread")])]),s("li",[s("a",{attrs:{href:"#本地交换空间-request-size-bytes-for-reason-out-of-swap-space"}},[a._v("本地交换空间 request size bytes for reason. Out of swap space?")])]),s("li",[s("a",{attrs:{href:"#直接内存溢出-allocatememory"}},[a._v("直接内存溢出 allocateMemory")])]),s("li",[s("a",{attrs:{href:"#gc-overhead-limit-exceeded"}},[a._v("GC Overhead limit exceeded")])]),s("li",[s("a",{attrs:{href:"#数组创建溢出-requested-array-size-exceeds-vm-limit"}},[a._v("数组创建溢出 Requested array size exceeds VM limit")])]),s("li",[s("a",{attrs:{href:"#本地方法分配失败-reason-stack-trace-with-native-method"}},[a._v("本地方法分配失败 reason stacktracewithnativemethod")])]),s("li",[s("a",{attrs:{href:"#压缩类空间-compressed-class-space"}},[a._v("压缩类空间 Compressed class space")])])])]),s("li",[s("a",{attrs:{href:"#stackoverflowerror-相关异常"}},[a._v("StackOverflowError 相关异常")])]),s("li",[s("a",{attrs:{href:"#说明"}},[a._v("说明")])]),s("li",[s("a",{attrs:{href:"#参考"}},[a._v("参考")])])])]),s("p"),a._v(" "),s("h2",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[a._v("#")]),a._v(" 前言")]),a._v(" "),s("p",[a._v("实际代码执行过程中经常遇到 OOM 相关异常，本篇内容基于 JDK13 总结各种 OOM 相关联内存区域。方便定位是哪一块内存区域的问题，然后进行参数调优。")]),a._v(" "),s("h2",{attrs:{id:"outofmemoryerror-相关异常"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#outofmemoryerror-相关异常"}},[a._v("#")]),a._v(" OutOfMemoryError 相关异常")]),a._v(" "),s("p",[a._v("一般情况下，OutOfMemoryError 异常后会跟随「Java heap space」描述。具体的异常定位还需要参考调用链「at ...」部分来定位。")]),a._v(" "),s("p",[a._v("OutOfMemoryError 涉及的异常情况较多，可使用查找定位本节内容列出的异常情况。")]),a._v(" "),s("h3",{attrs:{id:"java-堆内存溢出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#java-堆内存溢出"}},[a._v("#")]),a._v(" Java 堆内存溢出")]),a._v(" "),s("p",[a._v("可通过 "),s("code",[a._v("-Xms20m -Xmx20m")]),a._v(" 设置堆大小。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Exception")]),a._v(" in thread "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"main"')]),a._v(" java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OutOfMemoryError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Java")]),a._v(" heap space\n\tat io"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gourd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jvm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("oom"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HeapOOM")]),a._v("$"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OomObj")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token generics"}},[s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("init"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HeapOOM")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("19")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\tat io"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gourd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jvm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("oom"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HeapOOM")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HeapOOM")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("27")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("h3",{attrs:{id:"字符串常量池溢出"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#字符串常量池溢出"}},[a._v("#")]),a._v(" 字符串常量池溢出")]),a._v(" "),s("p",[a._v("自 JDK 7 起，原本存放在永久代的字符串常量池被移至 Java 堆之中，所以在 JDK 7 及以上版本，限制方法区的容量对该测试用例来说是毫无意义的。")]),a._v(" "),s("blockquote",[s("p",[a._v("永久代和元空间只是《Java 虚拟机规范》方法区规范的实现，如果还在纠结这些概念可参考我 jvm 专栏的《运行时内存数据区域》内容")])]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Exception")]),a._v(" in thread "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"main"')]),a._v(" java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OutOfMemoryError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Java")]),a._v(" heap space\n    at java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HashMap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("resize")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HashMap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("704")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    at java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("util"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HashMap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("putVal")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("HashMap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("663")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 或者")]),a._v("\n\n"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Exception")]),a._v(" in thread 「main」 java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OutOfMemoryError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Java")]),a._v(" heap space \n    at java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("base"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("toString（"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Integer")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("440")]),a._v("） \n    at java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("base"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("/")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("valueOf（"),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("3058")]),a._v("）\n")])])]),s("h3",{attrs:{id:"方法区出现内存溢出-metaspace-或者-permgen-space"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法区出现内存溢出-metaspace-或者-permgen-space"}},[a._v("#")]),a._v(" 方法区出现内存溢出 Metaspace 或者 PermGen space")]),a._v(" "),s("p",[a._v("当前的很多主流框架，如 Spring、Hibernate 对类进行增强时，都会使用到 CGLib 这类字节码技术，当增强的类越多，就需要越大的方法区以保证动态生成的新类型可以载入内存。")]),a._v(" "),s("blockquote",[s("p",[a._v("PermGen space 是 JDK8 前永久代的异常，Metaspace 是 JDK8 后的元空间异常，其实都是虚拟机规范方法区的标准实现")])]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Caused")]),a._v(" by"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OutOfMemoryError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("PermGen")]),a._v(" space  "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("--")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v(" JDK8 以上 "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Metaspace")]),a._v("\n    at java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassLoader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("defineClass1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Native")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Method")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    at java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassLoader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("defineClassCond")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassLoader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("632")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    at java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassLoader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("defineClass")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("ClassLoader")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("616")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("ul",[s("li",[s("p",[a._v("-XX：MaxMetaspaceSize：设置元空间最大值，默认是-1，即不限制，或者说只受限于本地内存大小。")])]),a._v(" "),s("li",[s("p",[a._v("-XX：MetaspaceSize：指定元空间的初始空间大小，以字节为单位，达到该值就会触发垃圾收集进行类型卸载，同时收集器会对该值进行调整：如果释放了大量的空间，就适当降低该值；如果释放了很少的空间，那么在不超过-XX：MaxMetaspaceSize（如果设置了的话）的情况下，适当提高该值。")])]),a._v(" "),s("li",[s("p",[a._v("-XX：MinMetaspaceFreeRatio：作用是在垃圾收集之后控制最小的元空间剩余容量的百分比，可减少因为元空间不足导致的垃圾收集的频率。类似的还有-XX：Max-MetaspaceFreeRatio，用于控制最大的元空间剩余容量的百分比。")])])]),a._v(" "),s("h3",{attrs:{id:"创建线程导致内存溢出-unable-to-create-native-thread"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建线程导致内存溢出-unable-to-create-native-thread"}},[a._v("#")]),a._v(" 创建线程导致内存溢出 unable to create native thread")]),a._v(" "),s("p",[a._v("虚拟机的栈内存允许动态扩展，当扩展栈容量无法申请到足够的内存时，将抛出 OutOfMemoryError 异常")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Exception")]),a._v(" in thread "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"main"')]),a._v(" java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OutOfMemoryError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" unable "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("to")]),a._v(" create "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("native")]),a._v(" thread\n")])])]),s("h3",{attrs:{id:"本地交换空间-request-size-bytes-for-reason-out-of-swap-space"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本地交换空间-request-size-bytes-for-reason-out-of-swap-space"}},[a._v("#")]),a._v(" 本地交换空间 request size bytes for reason. Out of swap space?")]),a._v(" "),s("p",[a._v("当本机堆分配失败且本机堆可能接近耗尽时，Java HotSpot VM 代码会报告这个明显的异常。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v(" java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OutOfMemoryError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" request size bytes "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("for")]),a._v(" reason"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Out")]),a._v(" of swap space"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("?")]),a._v("\n")])])]),s("h3",{attrs:{id:"直接内存溢出-allocatememory"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#直接内存溢出-allocatememory"}},[a._v("#")]),a._v(" 直接内存溢出 allocateMemory")]),a._v(" "),s("p",[a._v("直接内存（Direct Memory）的容量大小可通过 -XX：MaxDirectMemorySize 参数来指定。根据异常链 "),s("code",[a._v("allocateMemory")]),a._v(" 方法跟踪定位。")]),a._v(" "),s("p",[a._v("如果不去指定，则默认与 Java 堆最大值（由 -Xmx 指定）一致")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Exception")]),a._v(" in thread "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v('"main"')]),a._v(" java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OutOfMemoryError")]),a._v("\n    at sun"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("misc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Unsafe")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("allocateMemory")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Native")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Method")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n    at io"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("gourd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("jvm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("oom"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DirectMemoryOOM")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("main")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("DirectMemoryOOM")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("java"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("25")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])])]),s("h3",{attrs:{id:"gc-overhead-limit-exceeded"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#gc-overhead-limit-exceeded"}},[a._v("#")]),a._v(" GC Overhead limit exceeded")]),a._v(" "),s("p",[a._v("Java 进程超出 98% 的时间在做垃圾回收工作，工作中恢复了不到 2% 的堆空间。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v("java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OutOfMemoryError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" GC "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Overhead")]),a._v(" limit exceeded\n")])])]),s("p",[a._v("一般情况下：增加堆大小")]),a._v(" "),s("p",[a._v("也可以使用 -XX:-UseGCOverheadLimit 来关闭该异常")]),a._v(" "),s("h3",{attrs:{id:"数组创建溢出-requested-array-size-exceeds-vm-limit"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#数组创建溢出-requested-array-size-exceeds-vm-limit"}},[a._v("#")]),a._v(" 数组创建溢出 Requested array size exceeds VM limit")]),a._v(" "),s("p",[a._v("请求的数组大小超过 VM 限制，表示程序将创建一个大于堆大小的数组。")]),a._v(" "),s("p",[a._v("比如堆为 256M，程序试图创建一个 512M 的数组。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v(" java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OutOfMemoryError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Requested")]),a._v(" array size exceeds VM limit\n")])])]),s("p",[a._v("一般情况下增加堆大小或者控制数组大小。")]),a._v(" "),s("h3",{attrs:{id:"本地方法分配失败-reason-stack-trace-with-native-method"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#本地方法分配失败-reason-stack-trace-with-native-method"}},[a._v("#")]),a._v(" 本地方法分配失败 reason stack_trace_with_native_method")]),a._v(" "),s("p",[a._v("堆栈跟踪中顶部的帧是本机方法，那么这表明本机方法遇到了分配失败。")]),a._v(" "),s("p",[a._v("分配失败是在 Java 本机接口 (JNI) 或本机方法中检测到的，而不是在 JVM 代码中。")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v(" java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OutOfMemoryError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" reason stack_trace_with_native_method\n")])])]),s("h3",{attrs:{id:"压缩类空间-compressed-class-space"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#压缩类空间-compressed-class-space"}},[a._v("#")]),a._v(" 压缩类空间 Compressed class space")]),a._v(" "),s("p",[a._v("在 64 位平台上，类元数据的指针可以用 32 位偏移量表示 (UseCompressedOops，默认开启)，类元数据可用的空间量将固定在 CompressedClassSpaceSize")]),a._v(" "),s("div",{staticClass:"language-java extra-class"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[a._v(" java"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("lang"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("OutOfMemoryError")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(":")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Compressed")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("class")]),a._v(" space\n")])])]),s("p",[a._v("一般情况下增加压缩空间"),s("code",[a._v("-XX: CompressedClassSpaceSize=4g")]),a._v("或者关闭使用压缩。")]),a._v(" "),s("blockquote",[s("p",[a._v("注意:类元数据不止一种，即对象头信息-类型指针和其他元数据。只有对象头信息-类型指针存储在压缩类空间中。其他元数据存储在 Metaspace 中。参考本专栏《对象的创建与访问过程》详细了解。")])]),a._v(" "),s("h2",{attrs:{id:"stackoverflowerror-相关异常"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stackoverflowerror-相关异常"}},[a._v("#")]),a._v(" StackOverflowError 相关异常")]),a._v(" "),s("p",[a._v("线程请求的栈深度大于虚拟机所允许的最大深度，将抛出 StackOverflowError 异常")]),a._v(" "),s("p",[a._v("栈容量只能由 -Xss 参数来设定。关于虚拟机栈和本地方法栈在《Java 虚拟机规范》中描述了两种异常：")]),a._v(" "),s("ul",[s("li",[a._v("线程请求的栈深度大于虚拟机所允许的最大深度，将抛出 StackOverflowError 异常。")]),a._v(" "),s("li",[a._v("虚拟机的栈内存允许动态扩展，当扩展栈容量无法申请到足够的内存时，将抛出 OutOfMemoryError 异常。参考「方法区出现内存溢出」。")])]),a._v(" "),s("h2",{attrs:{id:"说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#说明"}},[a._v("#")]),a._v(" 说明")]),a._v(" "),s("p",[a._v("相关测试代码参考-"),s("a",{attrs:{href:"https://github.com/GourdErwa/java-advanced/tree/master/java-jvm/src/main/java/io/gourd/java/jvm/oom",target:"_blank",rel:"noopener noreferrer"}},[a._v("源码 "),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("实际生产过程中我们可以选择更多的工具进行运行监控、分析 dump 文件：")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://www.eclipse.org/mat/",target:"_blank",rel:"noopener noreferrer"}},[a._v("推荐 Memory Analyzer (MAT)"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://docs.oracle.com/javase/9/tools/jhsdb.htm",target:"_blank",rel:"noopener noreferrer"}},[a._v("jhsdb"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"http://openjdk.java.net/tools/svc/jconsole/",target:"_blank",rel:"noopener noreferrer"}},[a._v("jconsole"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://docs.oracle.com/javacomponents/jmc-5-4/jfr-runtime-guide/run.htm#JFRUH176",target:"_blank",rel:"noopener noreferrer"}},[a._v("推荐 Flight Recorder-飞行记录仪"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://www.oracle.com/technetwork/java/javaseproducts/mission-control/java-mission-control-1998576.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Java Mission Control"),s("OutboundLink")],1)]),a._v(" "),s("li",[s("a",{attrs:{href:"https://www.ej-technologies.com/products/jprofiler/overview.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("推荐 jprofiler-付费 "),s("OutboundLink")],1)])]),a._v(" "),s("blockquote",[s("p",[a._v("更多 JDK 相关命令详细用法可参考  "),s("a",{attrs:{href:"https://blog.csdn.net/xiaohulunb/article/details/103887785",target:"_blank",rel:"noopener noreferrer"}},[a._v("Java JVM JDK13 诊断命令处理工具 jps,jstat,jinfo,jmap,jstack,jcmd"),s("OutboundLink")],1)])]),a._v(" "),s("p",[a._v("更多故障诊断及调优，参考本专栏 "),s("a",{attrs:{href:"https://blog.csdn.net/xiaohulunb/article/details/103828570",target:"_blank",rel:"noopener noreferrer"}},[a._v("Java JVM（JDK13）-专栏文章目录汇总"),s("OutboundLink")],1),a._v("。")]),a._v(" "),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[a._v("#")]),a._v(" 参考")]),a._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/13/troubleshoot/troubleshoot-memory-leaks.html#GUID-19F6D28E-75A1-4480-9879-D0932B2F305B",target:"_blank",rel:"noopener noreferrer"}},[a._v("Understand the OutOfMemoryError Exception"),s("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=r.exports}}]);