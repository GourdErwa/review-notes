<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>复盘笔记（review-notes）</title>
    <meta name="description" content="review notes">
    
    
    <link rel="preload" href="/review-notes/assets/css/0.styles.5932ac7e.css" as="style"><link rel="preload" href="/review-notes/assets/js/app.52f4aa5e.js" as="script"><link rel="preload" href="/review-notes/assets/js/2.ab8e20bd.js" as="script"><link rel="preload" href="/review-notes/assets/js/14.c6d9f10f.js" as="script"><link rel="prefetch" href="/review-notes/assets/js/10.83ba425f.js"><link rel="prefetch" href="/review-notes/assets/js/11.149cb360.js"><link rel="prefetch" href="/review-notes/assets/js/12.4b5abdcf.js"><link rel="prefetch" href="/review-notes/assets/js/13.674b4ae4.js"><link rel="prefetch" href="/review-notes/assets/js/15.bf1e6513.js"><link rel="prefetch" href="/review-notes/assets/js/16.c137ebde.js"><link rel="prefetch" href="/review-notes/assets/js/17.39f79cb6.js"><link rel="prefetch" href="/review-notes/assets/js/18.8c5cbb34.js"><link rel="prefetch" href="/review-notes/assets/js/19.00661739.js"><link rel="prefetch" href="/review-notes/assets/js/20.7fc96367.js"><link rel="prefetch" href="/review-notes/assets/js/21.acae0ead.js"><link rel="prefetch" href="/review-notes/assets/js/22.fb703855.js"><link rel="prefetch" href="/review-notes/assets/js/23.081b77b6.js"><link rel="prefetch" href="/review-notes/assets/js/24.b8ba5d30.js"><link rel="prefetch" href="/review-notes/assets/js/25.5ddcfbc2.js"><link rel="prefetch" href="/review-notes/assets/js/26.e596cd0b.js"><link rel="prefetch" href="/review-notes/assets/js/27.3f952dbf.js"><link rel="prefetch" href="/review-notes/assets/js/28.6d9e9c11.js"><link rel="prefetch" href="/review-notes/assets/js/29.f6578613.js"><link rel="prefetch" href="/review-notes/assets/js/3.c9b9577a.js"><link rel="prefetch" href="/review-notes/assets/js/30.103f4cb6.js"><link rel="prefetch" href="/review-notes/assets/js/31.c3a576fc.js"><link rel="prefetch" href="/review-notes/assets/js/32.ea826597.js"><link rel="prefetch" href="/review-notes/assets/js/33.8094a593.js"><link rel="prefetch" href="/review-notes/assets/js/34.c5010d75.js"><link rel="prefetch" href="/review-notes/assets/js/35.9944f6de.js"><link rel="prefetch" href="/review-notes/assets/js/36.68df1563.js"><link rel="prefetch" href="/review-notes/assets/js/37.8c77e80c.js"><link rel="prefetch" href="/review-notes/assets/js/38.8f54e16f.js"><link rel="prefetch" href="/review-notes/assets/js/39.e7a67243.js"><link rel="prefetch" href="/review-notes/assets/js/4.2f07fd93.js"><link rel="prefetch" href="/review-notes/assets/js/40.5e4714e6.js"><link rel="prefetch" href="/review-notes/assets/js/41.db30904f.js"><link rel="prefetch" href="/review-notes/assets/js/42.6501f103.js"><link rel="prefetch" href="/review-notes/assets/js/43.7db8e700.js"><link rel="prefetch" href="/review-notes/assets/js/44.4fc96f8b.js"><link rel="prefetch" href="/review-notes/assets/js/45.56b7728b.js"><link rel="prefetch" href="/review-notes/assets/js/46.8c71a69c.js"><link rel="prefetch" href="/review-notes/assets/js/47.492d09cd.js"><link rel="prefetch" href="/review-notes/assets/js/48.4249a603.js"><link rel="prefetch" href="/review-notes/assets/js/49.6f1f1645.js"><link rel="prefetch" href="/review-notes/assets/js/5.4a0b9b5d.js"><link rel="prefetch" href="/review-notes/assets/js/50.079abcc4.js"><link rel="prefetch" href="/review-notes/assets/js/51.6531d358.js"><link rel="prefetch" href="/review-notes/assets/js/52.76c0f2cb.js"><link rel="prefetch" href="/review-notes/assets/js/53.87f0f880.js"><link rel="prefetch" href="/review-notes/assets/js/54.3497cf92.js"><link rel="prefetch" href="/review-notes/assets/js/55.8cd21102.js"><link rel="prefetch" href="/review-notes/assets/js/56.7562944a.js"><link rel="prefetch" href="/review-notes/assets/js/57.90ac7289.js"><link rel="prefetch" href="/review-notes/assets/js/58.62159699.js"><link rel="prefetch" href="/review-notes/assets/js/59.e274d0e7.js"><link rel="prefetch" href="/review-notes/assets/js/6.9c13e562.js"><link rel="prefetch" href="/review-notes/assets/js/7.8225561c.js"><link rel="prefetch" href="/review-notes/assets/js/8.8641d846.js"><link rel="prefetch" href="/review-notes/assets/js/9.e6b49f49.js">
    <link rel="stylesheet" href="/review-notes/assets/css/0.styles.5932ac7e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/review-notes/" class="home-link router-link-active"><!----> <span class="site-name">复盘笔记（review-notes）</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/review-notes/language/java-concurrency/" class="nav-link">Java 并发编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术框架" class="dropdown-title"><span class="title">技术框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/review-notes/framework/flink-basis/" class="nav-link router-link-active">Flink 入门进阶</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/review-notes/algorithm/data-structures/" class="nav-link">数据结构</a></li></ul></div></div> <a href="https://github.com/GourdErwa/review-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/review-notes/language/java-concurrency/" class="nav-link">Java 并发编程</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术框架" class="dropdown-title"><span class="title">技术框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/review-notes/framework/flink-basis/" class="nav-link router-link-active">Flink 入门进阶</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/review-notes/algorithm/data-structures/" class="nav-link">数据结构</a></li></ul></div></div> <a href="https://github.com/GourdErwa/review-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flink 基础概念</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>DataSet（Batch）</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/review-notes/framework/flink-basis/DataSet概览.html" class="active sidebar-link">DataSet概览</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_1-示例程序" class="sidebar-link">1 示例程序</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_2-程序数据源输入（data-sources）" class="sidebar-link">2 程序数据源输入（Data Sources）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_2-1-基于文件：" class="sidebar-link">2.1 基于文件：</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_2-2-基于集合：" class="sidebar-link">2.2 基于集合：</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_2-3-通用：" class="sidebar-link">2.3 通用：</a></li></ul></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_3-程序数据输出（data-sinks）" class="sidebar-link">3 程序数据输出（Data Sinks）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-转换操作（transformations）" class="sidebar-link">4 转换操作（Transformations）</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-1-map" class="sidebar-link">4.1 Map</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-2-flatmap" class="sidebar-link">4.2 FlatMap</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-3-mappartition" class="sidebar-link">4.3 MapPartition</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-4-filter" class="sidebar-link">4.4 Filter</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-5-projection-of-tuple-dataset（元组数据集投影）" class="sidebar-link">4.5 Projection of Tuple DataSet（元组数据集投影）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-6-transformations-on-grouped-dataset（分组数据集的转换）" class="sidebar-link">4.6 Transformations on Grouped DataSet（分组数据集的转换）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-7-reduce-on-grouped-dataset（减少分组数据集）" class="sidebar-link">4.7 Reduce on Grouped DataSet（减少分组数据集）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-8-groupreduce-on-grouped-dataset（分组数据集上的groupreduce）" class="sidebar-link">4.8 GroupReduce on Grouped DataSet（分组数据集上的GroupReduce）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-9-可组合的groupreduce函数" class="sidebar-link">4.9 可组合的GroupReduce函数</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-10-groupcombine-on-a-grouped-dataset（分组数据集上的groupcombine）" class="sidebar-link">4.10 GroupCombine on a Grouped DataSet（分组数据集上的GroupCombine）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-11-aggregate-on-grouped-tuple-dataset（在分组元组数据集聚合）" class="sidebar-link">4.11 Aggregate on Grouped Tuple DataSet（在分组元组数据集聚合）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-12-minby-maxby-on-grouped-tuple-dataset（分组元组数据集上的minby-maxby）" class="sidebar-link">4.12 MinBy / MaxBy on Grouped Tuple DataSet（分组元组数据集上的MinBy / MaxBy）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-13-reduce-on-full-dataset（减少完整的dataset）" class="sidebar-link">4.13 Reduce on full DataSet（减少完整的DataSet）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-14-groupreduce-on-full-dataset（完整数据集上的groupreduce）" class="sidebar-link">4.14 GroupReduce on full DataSet（完整数据集上的GroupReduce）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-15-groupcombine-on-a-full-dataset（完整数据集上的groupcombine）" class="sidebar-link">4.15 GroupCombine on a full DataSet（完整数据集上的GroupCombine）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-16-aggregate-on-full-tuple-dataset（完整数据集上聚合）" class="sidebar-link">4.16 Aggregate on full Tuple DataSet（完整数据集上聚合）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-17-minby-maxby-on-full-tuple-dataset（完整数据集上的minby-maxby）" class="sidebar-link">4.17 MinBy/MaxBy on full Tuple DataSet（完整数据集上的MinBy/MaxBy）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-18-distinct（去重）" class="sidebar-link">4.18 Distinct（去重）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-19-join" class="sidebar-link">4.19 Join</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-20-outerjoin" class="sidebar-link">4.20 OuterJoin</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-21-cross" class="sidebar-link">4.21 Cross</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-22-cogroup" class="sidebar-link">4.22 CoGroup</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-23-union" class="sidebar-link">4.23 Union</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-24-rebalance-重新平衡" class="sidebar-link">4.24 Rebalance(重新平衡)</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-25-hash-partition-哈希分区" class="sidebar-link">4.25 Hash-Partition(哈希分区)</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-26-range-partition（范围分区）" class="sidebar-link">4.26 Range-Partition（范围分区）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-27-sort-partition（分区排序）" class="sidebar-link">4.27 Sort Partition（分区排序）</a></li><li class="sidebar-sub-header"><a href="/review-notes/framework/flink-basis/DataSet概览.html#_4-28-first-n（前n个（任意）元素）" class="sidebar-link">4.28 First-n（前n个（任意）元素）</a></li></ul></li></ul></li><li><a href="/review-notes/framework/flink-basis/DataSet分配唯一标识符.html" class="sidebar-link">DataSet分配唯一标识符</a></li><li><a href="/review-notes/framework/flink-basis/DataSet参数传递.html" class="sidebar-link">DataSet参数传递</a></li><li><a href="/review-notes/framework/flink-basis/DataSet广播变量.html" class="sidebar-link">DataSet广播变量</a></li><li><a href="/review-notes/framework/flink-basis/DataSet分布式缓冲.html" class="sidebar-link">DataSet分布式缓冲</a></li><li><a href="/review-notes/framework/flink-basis/DataSet语义注解.html" class="sidebar-link">DataSet语义注解</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>DataStream（Streaming）</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>专栏原创出处：<a href="https://github.com/GourdErwa/review-notes/tree/master/framework/flink-basis" target="_blank" rel="noopener noreferrer">源笔记文件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，<a href="https://github.com/GourdErwa/flink-advanced" target="_blank" rel="noopener noreferrer">源码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><br>
本节内容部分<a href="https://github.com/GourdErwa/flink-advanced/blob/master/src/main/scala/io/gourd/flink/scala/games/batch/transformations" target="_blank" rel="noopener noreferrer">源码<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p></p><div class="table-of-contents"><ul><li><a href="#_1-示例程序">1 示例程序</a></li><li><a href="#_2-程序数据源输入（data-sources）">2 程序数据源输入（Data Sources）</a><ul><li><a href="#_2-1-基于文件：">2.1 基于文件：</a></li><li><a href="#_2-2-基于集合：">2.2 基于集合：</a></li><li><a href="#_2-3-通用：">2.3 通用：</a></li></ul></li><li><a href="#_3-程序数据输出（data-sinks）">3 程序数据输出（Data Sinks）</a></li><li><a href="#_4-转换操作（transformations）">4 转换操作（Transformations）</a><ul><li><a href="#_4-1-map">4.1 Map</a></li><li><a href="#_4-2-flatmap">4.2 FlatMap</a></li><li><a href="#_4-3-mappartition">4.3 MapPartition</a></li><li><a href="#_4-4-filter">4.4 Filter</a></li><li><a href="#_4-5-projection-of-tuple-dataset（元组数据集投影）">4.5 Projection of Tuple DataSet（元组数据集投影）</a></li><li><a href="#_4-6-transformations-on-grouped-dataset（分组数据集的转换）">4.6 Transformations on Grouped DataSet（分组数据集的转换）</a></li><li><a href="#_4-7-reduce-on-grouped-dataset（减少分组数据集）">4.7 Reduce on Grouped DataSet（减少分组数据集）</a></li><li><a href="#_4-8-groupreduce-on-grouped-dataset（分组数据集上的groupreduce）">4.8 GroupReduce on Grouped DataSet（分组数据集上的GroupReduce）</a></li><li><a href="#_4-9-可组合的groupreduce函数">4.9 可组合的GroupReduce函数</a></li><li><a href="#_4-10-groupcombine-on-a-grouped-dataset（分组数据集上的groupcombine）">4.10 GroupCombine on a Grouped DataSet（分组数据集上的GroupCombine）</a></li><li><a href="#_4-11-aggregate-on-grouped-tuple-dataset（在分组元组数据集聚合）">4.11 Aggregate on Grouped Tuple DataSet（在分组元组数据集聚合）</a></li><li><a href="#_4-12-minby-maxby-on-grouped-tuple-dataset（分组元组数据集上的minby-maxby）">4.12 MinBy / MaxBy on Grouped Tuple DataSet（分组元组数据集上的MinBy / MaxBy）</a></li><li><a href="#_4-13-reduce-on-full-dataset（减少完整的dataset）">4.13 Reduce on full DataSet（减少完整的DataSet）</a></li><li><a href="#_4-14-groupreduce-on-full-dataset（完整数据集上的groupreduce）">4.14 GroupReduce on full DataSet（完整数据集上的GroupReduce）</a></li><li><a href="#_4-15-groupcombine-on-a-full-dataset（完整数据集上的groupcombine）">4.15 GroupCombine on a full DataSet（完整数据集上的GroupCombine）</a></li><li><a href="#_4-16-aggregate-on-full-tuple-dataset（完整数据集上聚合）">4.16 Aggregate on full Tuple DataSet（完整数据集上聚合）</a></li><li><a href="#_4-17-minby-maxby-on-full-tuple-dataset（完整数据集上的minby-maxby）">4.17 MinBy/MaxBy on full Tuple DataSet（完整数据集上的MinBy/MaxBy）</a></li><li><a href="#_4-18-distinct（去重）">4.18 Distinct（去重）</a></li><li><a href="#_4-19-join">4.19 Join</a></li><li><a href="#_4-20-outerjoin">4.20 OuterJoin</a></li><li><a href="#_4-21-cross">4.21 Cross</a><ul><li><a href="#cross-with-自定义函数">Cross with 自定义函数</a></li><li><a href="#cross-with-数据集大小预估提示">Cross with 数据集大小预估提示</a></li></ul></li><li><a href="#_4-22-cogroup">4.22 CoGroup</a></li><li><a href="#_4-23-union">4.23 Union</a></li><li><a href="#_4-24-rebalance-重新平衡">4.24 Rebalance(重新平衡)</a></li><li><a href="#_4-25-hash-partition-哈希分区">4.25 Hash-Partition(哈希分区)</a></li><li><a href="#_4-26-range-partition（范围分区）">4.26 Range-Partition（范围分区）</a></li><li><a href="#_4-27-sort-partition（分区排序）">4.27 Sort Partition（分区排序）</a></li><li><a href="#_4-28-first-n（前n个（任意）元素）">4.28 First-n（前n个（任意）元素）</a></li></ul></li></ul></div><p></p> <h2 id="_1-示例程序"><a href="#_1-示例程序" class="header-anchor">#</a> 1 示例程序</h2> <p><a href="https://github.com/GourdErwa/flink-advanced/blob/master/src/main/scala/io/gourd/flink/scala/games/batch/Batch.scala" target="_blank" rel="noopener noreferrer">Batch.scala<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 操作原始 DataSet API 完成 2个表数据过滤join聚合操作</span>
object <span class="token class-name">BatchDataSet</span> <span class="token keyword">extends</span> <span class="token class-name">BatchExecutionEnvironmentApp</span> <span class="token punctuation">{</span>

  <span class="token comment">// 用户登录数据 DataSet</span>
  val userLoginDataSet <span class="token operator">=</span> <span class="token class-name">DataSet</span><span class="token punctuation">.</span><span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token comment">// 角色登录数据 DataSet</span>
  val roleLoginDataSet <span class="token operator">=</span> <span class="token class-name">DataSet</span><span class="token punctuation">.</span><span class="token function">roleLogin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

  userLoginDataSet
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>dataUnix <span class="token operator">&gt;</span> <span class="token number">1571414499</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token string">&quot;LOGIN&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>roleLoginDataSet<span class="token punctuation">,</span> <span class="token class-name">JoinHint</span><span class="token punctuation">.</span>BROADCAST_HASH_FIRST<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>uid<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">(</span>left<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> left<span class="token punctuation">.</span>platform <span class="token operator">-&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sortPartition</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token class-name">Order</span><span class="token punctuation">.</span>ASCENDING<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 操作 Table API 完成 2个表数据过滤join聚合操作</span>
object <span class="token class-name">BatchTable</span> <span class="token keyword">extends</span> <span class="token class-name">BatchTableEnvironmentApp</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> val userLogin <span class="token operator">=</span> <span class="token class-name">RegisterDataSet</span><span class="token punctuation">.</span><span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> val roleLogin <span class="token operator">=</span> <span class="token class-name">RegisterDataSet</span><span class="token punctuation">.</span><span class="token function">roleLogin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

  btEnv<span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span>userLogin<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;platform,dataUnix,uid,status&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">'dataUnix &gt; 1571414499 &amp;&amp; '</span>status <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">&quot;LOGIN&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>btEnv<span class="token punctuation">.</span><span class="token function">scan</span><span class="token punctuation">(</span>roleLogin<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;uid as r_uid&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;uid = r_uid&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">groupBy</span><span class="token punctuation">(</span><span class="token string">&quot;platform&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&quot;platform as p , count(platform) as c&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">orderBy</span><span class="token punctuation">(</span>'c<span class="token punctuation">.</span>asc<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>toDataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 操作 SQL 完成 2个表数据过滤join聚合操作</span>
object <span class="token class-name">BatchSQL</span> <span class="token keyword">extends</span> <span class="token class-name">BatchTableEnvironmentApp</span> <span class="token punctuation">{</span>

  <span class="token keyword">private</span> val table <span class="token operator">=</span> <span class="token class-name">RegisterDataSet</span><span class="token punctuation">.</span><span class="token function">userLogin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

  btEnv<span class="token punctuation">.</span><span class="token function">sqlQuery</span><span class="token punctuation">(</span>
    s<span class="token string">&quot;&quot;</span>&quot;
       <span class="token operator">|</span>SELECT platform <span class="token class-name">AS</span> p<span class="token punctuation">,</span><span class="token function">COUNT</span><span class="token punctuation">(</span>platform<span class="token punctuation">)</span> AS c FROM
       <span class="token operator">|</span><span class="token punctuation">(</span>
       <span class="token operator">|</span><span class="token class-name">SELECT</span> platform<span class="token punctuation">,</span>dataUnix<span class="token punctuation">,</span>uid<span class="token punctuation">,</span>status FROM $table
       <span class="token operator">|</span>WHERE dataUnix <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token class-name">AND</span> status <span class="token operator">=</span> <span class="token string">'LOGIN'</span>
       <span class="token operator">|</span><span class="token punctuation">)</span>
       <span class="token operator">|</span>GROUP BY platform
       <span class="token operator">|</span><span class="token string">&quot;&quot;</span>&quot;<span class="token punctuation">.</span>stripMargin<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>toDataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_2-程序数据源输入（data-sources）"><a href="#_2-程序数据源输入（data-sources）" class="header-anchor">#</a> 2 程序数据源输入（Data Sources）</h2> <h3 id="_2-1-基于文件："><a href="#_2-1-基于文件：" class="header-anchor">#</a> 2.1 基于文件：</h3> <ul><li><code>readTextFile(path)// TextInputFormat</code>-逐行读取文件，并将它们作为字符串返回。</li> <li><code>readTextFileWithValue(path)// TextValueInputFormat</code>-逐行读取文件，并将它们作为StringValues返回。StringValues 是可变字符串。</li> <li><code>readCsvFile(path)// CsvInputFormat</code>-解析以逗号（或其他字符）分隔的字段的文件。返回元组，case class对象或POJO的数据集。支持基本的Java类型及其与Value相对应的字段类型。</li> <li><code>readFileOfPrimitives(path, delimiter)</code>// PrimitiveInputFormat-解析以换行符（或其他char序列）定界的原始数据类型的文件，例如String或Integer使用给定的定界符。</li> <li><code>readSequenceFile(Key, Value, path)</code>// SequenceFileInputFormat-创建JobConf并从指定的路径中读取类型为SequenceFileInputFormat，Key类和Value类的文件，并将它们作为Tuple2 &lt;Key，Value&gt;返回。</li></ul> <h3 id="_2-2-基于集合："><a href="#_2-2-基于集合：" class="header-anchor">#</a> 2.2 基于集合：</h3> <ul><li><code>fromCollection(Iterable)</code>-从Iterable创建数据集。Iterable 返回的所有元素都必须是同一类型。</li> <li><code>fromCollection(Iterator)</code>-从迭代器创建数据集。该类指定迭代器返回的元素的数据类型。</li> <li><code>fromElements(elements: _*)</code>-从给定的对象序列创建数据集。所有对象必须具有相同的类型。</li> <li><code>fromParallelCollection(SplittableIterator)</code>-从迭代器并行创建数据集。该类指定迭代器返回的元素的数据类型。</li> <li><code>generateSequence(from, to)</code> -并行生成给定间隔中的数字序列。</li></ul> <h3 id="_2-3-通用："><a href="#_2-3-通用：" class="header-anchor">#</a> 2.3 通用：</h3> <ul><li><code>readFile(inputFormat, path)// FileInputFormat</code>-接受文件输入格式。</li> <li><code>createInput(inputFormat)// InputFormat</code>-接受通用输入格式。</li></ul> <h2 id="_3-程序数据输出（data-sinks）"><a href="#_3-程序数据输出（data-sinks）" class="header-anchor">#</a> 3 程序数据输出（Data Sinks）</h2> <ul><li><code>writeAsText()</code>// TextOutputFormat-将元素按行写为字符串。通过调用每个元素的 toString（）方法获得字符串。</li> <li><code>writeAsCsv(...)</code>// CsvOutputFormat-将元组写为逗号分隔的值文件。行和字段定界符是可配置的。每个字段的值来自对象的 toString（）方法。</li> <li><code>print()</code>// printToErr()- 在标准输出/标准错误流上打印每个元素的 toString（）值。</li> <li><code>write()</code>// FileOutputFormat-自定义文件输出的方法和基类。支持自定义对象到字节的转换。</li> <li><code>output()</code>// OutputFormat-最通用的输出方法，用于不基于文件的数据接收器（例如将结果存储在数据库中）。</li></ul> <h2 id="_4-转换操作（transformations）"><a href="#_4-转换操作（transformations）" class="header-anchor">#</a> 4 转换操作（Transformations）</h2> <h3 id="_4-1-map"><a href="#_4-1-map" class="header-anchor">#</a> 4.1 Map</h3> <p>Map转换将用户定义的map函数应用于DataSet的每个元素。它实现了一对一的映射，也就是说，函数必须恰好返回一个元素。</p> <div class="language- extra-class"><pre class="language-text"><code>val intPairs: DataSet[(Int, Int)] = // [...]
val intSums = intPairs.map { pair =&gt; pair._1 + pair._2 }
</code></pre></div><h3 id="_4-2-flatmap"><a href="#_4-2-flatmap" class="header-anchor">#</a> 4.2 FlatMap</h3> <p>FlatMap转换在数据集的每个元素上应用用户定义的FlatMap方法。映射函数的可以为每个输入元素返回任意许多结果元素（包括无结果元素）。</p> <div class="language- extra-class"><pre class="language-text"><code>val textLines: DataSet[String] = // [...]
val words = textLines.flatMap { _.split(&quot; &quot;) }
</code></pre></div><h3 id="_4-3-mappartition"><a href="#_4-3-mappartition" class="header-anchor">#</a> 4.3 MapPartition</h3> <p>MapPartition在单个函数调用中转换并行分区。map-partition函数将分区获取为Iterable，并可以产生任意数量的结果值。每个分区中元素的数量取决于并行度和先前的操作。</p> <div class="language- extra-class"><pre class="language-text"><code>val textLines: DataSet[String] = // [...]
// 因为返回值必须是Collection，所以需要Some
// 从Option到Collection的隐式转换
val counts = texLines.mapPartition { in =&gt; Some(in.size) }
</code></pre></div><h3 id="_4-4-filter"><a href="#_4-4-filter" class="header-anchor">#</a> 4.4 Filter</h3> <p>Filter转换将用户定义的过滤器功能应用于DataSet的每个元素，并仅保留函数返回的那些元素true。</p> <div class="language- extra-class"><pre class="language-text"><code>val intNumbers: DataSet[Int] = // [...]
val naturalNumbers = intNumbers.filter { _ &gt; 0 }
</code></pre></div><h3 id="_4-5-projection-of-tuple-dataset（元组数据集投影）"><a href="#_4-5-projection-of-tuple-dataset（元组数据集投影）" class="header-anchor">#</a> 4.5 Projection of Tuple DataSet（元组数据集投影）</h3> <p>project转换将删除或移动元组数据集的元组字段。该project(int...)方法选择应由其索引保留的元组字段，并在输出元组中定义其顺序。
project不需要定义函数体</p> <div class="language- extra-class"><pre class="language-text"><code>DataSet&lt;Tuple3&lt;Integer, Double, String&gt;&gt; in = // [...]
// converts Tuple3&lt;Integer, Double, String&gt; into Tuple2&lt;String, Integer&gt;
DataSet&lt;Tuple2&lt;String, Integer&gt;&gt; out = in.project(2,0);
</code></pre></div><p><strong>带有类型提示的投影</strong><br>
请注意，Java编译器无法推断project运算符的返回类型。如果您根据project运算符的结果调用另一个运算符，则可能会导致问题，例如：</p> <div class="language- extra-class"><pre class="language-text"><code>DataSet&lt;Tuple5&lt;String,String,String,String,String&gt;&gt; ds = ....
DataSet&lt;Tuple1&lt;String&gt;&gt; ds2 = ds.project(0).distinct(0);
</code></pre></div><p>可以通过如下提示project操作符的返回类型来克服此问题：</p> <div class="language- extra-class"><pre class="language-text"><code>DataSet&lt;Tuple1&lt;String&gt;&gt; ds2 = ds.&lt;Tuple1&lt;String&gt;&gt;project(0).distinct(0);
</code></pre></div><h3 id="_4-6-transformations-on-grouped-dataset（分组数据集的转换）"><a href="#_4-6-transformations-on-grouped-dataset（分组数据集的转换）" class="header-anchor">#</a> 4.6 Transformations on Grouped DataSet（分组数据集的转换）</h3> <p>reduce 操作可以对分组的数据集进行操作。指定用于分组的密钥可以通过多种方式完成：</p> <ul><li>关键表达，<code>groupBy(&quot;key&quot;)</code></li> <li>键选择器功能，<code>implements KeySelector</code></li> <li>一个或多个字段位置键（仅限元组数据集），<code>groupBy(0, 1)</code></li> <li>案例类别字段（仅案例类别），<code>groupBy(&quot;a&quot;, &quot;b&quot;)</code></li></ul> <h3 id="_4-7-reduce-on-grouped-dataset（减少分组数据集）"><a href="#_4-7-reduce-on-grouped-dataset（减少分组数据集）" class="header-anchor">#</a> 4.7 Reduce on Grouped DataSet（减少分组数据集）</h3> <p>应用于分组数据集的Reduce转换使用用户定义的reduce函数将每个组简化为单个元素。<br>
对于每组输入元素，reduce函数依次将成对的元素组合为一个元素，直到每组只剩下一个元素为止。</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token comment">// some ordinary POJO</span>
<span class="token keyword">class</span> WC<span class="token punctuation">(</span><span class="token keyword">val</span> word<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token keyword">val</span> count<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">def</span> <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// [...]</span>
<span class="token punctuation">}</span>

<span class="token keyword">val</span> words<span class="token operator">:</span> DataSet<span class="token punctuation">[</span>WC<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>
<span class="token keyword">val</span> wordCounts <span class="token operator">=</span> words<span class="token punctuation">.</span>groupBy <span class="token punctuation">{</span> _<span class="token punctuation">.</span>word <span class="token punctuation">}</span> reduce <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>w1<span class="token punctuation">,</span> w2<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token keyword">new</span> WC<span class="token punctuation">(</span>w1<span class="token punctuation">.</span>word<span class="token punctuation">,</span> w1<span class="token punctuation">.</span>count <span class="token operator">+</span> w2<span class="token punctuation">.</span>count<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-8-groupreduce-on-grouped-dataset（分组数据集上的groupreduce）"><a href="#_4-8-groupreduce-on-grouped-dataset（分组数据集上的groupreduce）" class="header-anchor">#</a> 4.8 GroupReduce on Grouped DataSet（分组数据集上的GroupReduce）</h3> <p>应用于分组数据集的GroupReduce转换为每个组调用用户定义的group-reduce函数。<br>
此与Reduce的区别在于，用户定义的函数可一次获取整个组。该函数在组的所有元素上使用Iterable调用，并且可以返回任意数量的结果元素。</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> input<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>
<span class="token keyword">val</span> output <span class="token operator">=</span> input<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reduceGroup <span class="token punctuation">{</span>
      <span class="token punctuation">(</span>in<span class="token punctuation">,</span> out<span class="token operator">:</span> Collector<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
        in<span class="token punctuation">.</span>toSet foreach <span class="token punctuation">(</span>out<span class="token punctuation">.</span>collect<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-9-可组合的groupreduce函数"><a href="#_4-9-可组合的groupreduce函数" class="header-anchor">#</a> 4.9 可组合的GroupReduce函数</h3> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">object</span> GroupReduceOnCombinatorGroupReduceFunctions <span class="token keyword">extends</span> Transformations <span class="token punctuation">{</span>
  roleLoginDs
    <span class="token punctuation">.</span>map<span class="token punctuation">(</span>o <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> o<span class="token punctuation">.</span>dataUnix<span class="token punctuation">,</span> o<span class="token punctuation">.</span>money<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">&quot;1|1051&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 筛选部分用户</span>
    <span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// 按用户 ID 分组</span>
    <span class="token punctuation">.</span>sortGroup<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> Order<span class="token punctuation">.</span>ASCENDING<span class="token punctuation">)</span> <span class="token comment">// 分组排序，按订单金额升序</span>
    <span class="token punctuation">.</span>reduceGroup<span class="token punctuation">(</span><span class="token keyword">new</span> MyCombinableGroupReducer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">/* sortGroup 后原始数据集
  (1|1051,1571798861,50.0)
  (1|1051,1571798861,64.0)
  (1|1051,1571798860,198.0)
  (1|1051,1571798859,328.0)
  (1|1051,1571798859,648.0)
 */</span>
 
   <span class="token comment">/* 计算结果为
  (1|1051,1571798859,976.0)
  (1|1051,1571798860,198.0)
  (1|1051,1571798861,114.0)
   */</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
  * 与 reduce 函数相比，group-reduce 函数不是可隐式组合的。
  * 为了使 group-reduce 函数可组合，它必须实现 GroupCombineFunction 接口。
  *
  * 要点：GroupCombineFunction 接口的通用输入和输出类型必须等于 GroupReduceFunction 的通用输入类型，
  * 如以下示例所示：
  */</span>
<span class="token keyword">import</span> <span class="token namespace">scala<span class="token punctuation">.</span>collection</span><span class="token punctuation">.</span>JavaConverters<span class="token punctuation">.</span>_

<span class="token keyword">class</span> MyCombinableGroupReducer
  <span class="token keyword">extends</span> GroupReduceFunction<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">with</span> GroupCombineFunction<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">override</span> <span class="token keyword">def</span> reduce<span class="token punctuation">(</span>values<span class="token operator">:</span> lang<span class="token punctuation">.</span>Iterable<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      out<span class="token operator">:</span> Collector<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    values<span class="token punctuation">.</span>iterator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asScala<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>o <span class="token keyword">=&gt;</span> out<span class="token punctuation">.</span>collect<span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">override</span> <span class="token keyword">def</span> combine<span class="token punctuation">(</span>values<span class="token operator">:</span> lang<span class="token punctuation">.</span>Iterable<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       out<span class="token operator">:</span> Collector<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> r <span class="token operator">=</span> values<span class="token punctuation">.</span>iterator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asScala<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span><span class="token punctuation">(</span>o1<span class="token punctuation">,</span> o2<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>o1<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> o1<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> o1<span class="token punctuation">.</span>_3 <span class="token operator">+</span> o2<span class="token punctuation">.</span>_3<span class="token punctuation">)</span><span class="token punctuation">)</span>
    out<span class="token punctuation">.</span>collect<span class="token punctuation">(</span>r<span class="token punctuation">)</span> <span class="token comment">// 合并相同 key 的价格</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-10-groupcombine-on-a-grouped-dataset（分组数据集上的groupcombine）"><a href="#_4-10-groupcombine-on-a-grouped-dataset（分组数据集上的groupcombine）" class="header-anchor">#</a> 4.10 GroupCombine on a Grouped DataSet（分组数据集上的GroupCombine）</h3> <p>GroupCombine转换是可组合GroupReduceFunction中的合并步骤的通用形式。<br>
从某种意义上讲，它是广义的，它允许将输入类型组合为I任意输出类型O。<br>
相反，GroupReduce中的Combine步骤仅允许从input type I到output type的组合I。<br>
这是因为GroupReduceFunction中的reduce步骤需要输入类型I。</p> <p>在一些应用中，期望在执行附加转换之前将数据集组合成中间格式（例如，以减小数据大小）。这可以通过具有很少成本的CombineGroup转换来实现。</p> <blockquote><p>注意：分组数据集上的GroupCombine使用贪婪策略在内存中执行，该策略可能不会一次处理所有数据，而是分多个步骤进行。它也可以在单个分区上执行，而无需像GroupReduce转换那样进行数据交换。这可能会导致部分结果。</p></blockquote> <p>下面的示例演示将CombineGroup转换用于替代WordCount实现。</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> input<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token comment">// The words received as input</span>

<span class="token keyword">val</span> combinedWords<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> input
  <span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>combineGroup <span class="token punctuation">{</span>
    <span class="token punctuation">(</span>words<span class="token punctuation">,</span> out<span class="token operator">:</span> Collector<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
        <span class="token keyword">var</span> key<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span>word <span class="token keyword">&lt;-</span> words<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            key <span class="token operator">=</span> word
            count <span class="token operator">+=</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
        out<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> count<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">val</span> output<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> combinedWords
  <span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>reduceGroup <span class="token punctuation">{</span>
    <span class="token punctuation">(</span>words<span class="token punctuation">,</span> out<span class="token operator">:</span> Collector<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
        <span class="token keyword">var</span> key<span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token keyword">null</span>
        <span class="token keyword">var</span> sum <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>word<span class="token punctuation">,</span> sum<span class="token punctuation">)</span> <span class="token keyword">&lt;-</span> words<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            key <span class="token operator">=</span> word
            sum <span class="token operator">+=</span> count
        <span class="token punctuation">}</span>
        out<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-11-aggregate-on-grouped-tuple-dataset（在分组元组数据集聚合）"><a href="#_4-11-aggregate-on-grouped-tuple-dataset（在分组元组数据集聚合）" class="header-anchor">#</a> 4.11 Aggregate on Grouped Tuple DataSet（在分组元组数据集聚合）</h3> <ul><li>有一些常用的聚合操作。聚合转换提供以下内置聚合功能：</li> <li>Sum</li> <li>Min, and</li> <li>Max</li></ul> <blockquote><p>聚合转换只能应用于元组数据集，并且仅支持用于分组的字段位置键。</p></blockquote> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token comment">// 角色付费数据 DataSet</span>
  <span class="token keyword">val</span> roleLoginDs <span class="token operator">=</span> DataSet<span class="token punctuation">.</span>rolePay<span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

  <span class="token punctuation">{</span> <span class="token comment">// aggregate</span>
    roleLoginDs
      <span class="token punctuation">.</span>map<span class="token punctuation">(</span>o <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> o<span class="token punctuation">.</span>dataUnix<span class="token punctuation">,</span> o<span class="token punctuation">.</span>money<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">&quot;0|102&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 筛选部分用户</span>
      <span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>Aggregations<span class="token punctuation">.</span>SUM<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
      <span class="token comment">// .aggregate(Aggregations.MIN, 1)</span>
      <span class="token comment">// .andMin(1)</span>
      <span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">/*
    .aggregate(Aggregations.SUM, 2) 计算结果为
    (0|1021,1571473389,396.0)
    (0|1024,1571543169,50.0)
    (0|1025,1571420259,648.0)
    (0|1025_199,1571577819,648.0)
    */</span>
    <span class="token comment">/*
    .aggregate(Aggregations.SUM, 2).andMin(1) 计算结果为
    (0|1021,1571471529,396.0)
    (0|1024,1571543169,50.0)
    (0|1025,1571420259,648.0)
    (0|1025_199,1571577819,648.0)
     */</span>
    <span class="token comment">/*
    .aggregate(Aggregations.SUM, 2).aggregate(Aggregations.MIN, 1) 计算结果为
    (0|1025_199,1571420259,648.0)
     */</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>要将多个聚合应用于一个DataSet，必须.and()在第一个聚合之后使用该函数，这意味着.aggregate(SUM, 0).and(MIN, 2)产生原始DataSet的字段0之和和字段2的最小值。<br>
与此相反，.aggregate(SUM, 0).aggregate(MIN, 2)将对聚合应用聚合。</p> <h3 id="_4-12-minby-maxby-on-grouped-tuple-dataset（分组元组数据集上的minby-maxby）"><a href="#_4-12-minby-maxby-on-grouped-tuple-dataset（分组元组数据集上的minby-maxby）" class="header-anchor">#</a> 4.12 MinBy / MaxBy on Grouped Tuple DataSet（分组元组数据集上的MinBy / MaxBy）</h3> <p>MinBy（MaxBy）转换为每个元组组选择一个元组。<br>
选定的元组是其一个或多个指定字段的值最小（最大）的元组。用于比较的字段必须是有效的关键字段，即可比较的字段。<br>
如果多个元组具有最小（最大）字段值，则返回这些元组中的任意元组。</p> <div class="language-scala extra-class"><pre class="language-scala"><code>  roleLoginDs
    <span class="token punctuation">.</span>map<span class="token punctuation">(</span>o <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>o<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> o<span class="token punctuation">.</span>dataUnix<span class="token punctuation">,</span> o<span class="token punctuation">.</span>money<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>_1<span class="token punctuation">.</span>contains<span class="token punctuation">(</span><span class="token string">&quot;1|1051&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>minBy<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">/* 原始数据集
  (1|1051,1571798859,648.0)
  (1|1051,1571798859,328.0)
  (1|1051,1571798860,198.0)
  (1|1051,1571798861,64.0)
  (1|1051,1571798861,50.0)
   */</span>

  <span class="token comment">/* 计算结果为
  (1|1051,1571798859,328.0)
   */</span>
</code></pre></div><h3 id="_4-13-reduce-on-full-dataset（减少完整的dataset）"><a href="#_4-13-reduce-on-full-dataset（减少完整的dataset）" class="header-anchor">#</a> 4.13 Reduce on full DataSet（减少完整的DataSet）</h3> <p>Reduce转换将用户定义的reduce函数应用于DataSet的所有元素。reduce函数随后将成对的元素组合为一个元素，直到仅剩下一个元素为止。</p> <blockquote><p>使用Reduce转换来减少完整的DataSet意味着最终的Reduce操作不能并行进行。但是，reduce函数可以自动组合，因此Reduce转换在大多数情况下都不会限制可伸缩性。</p></blockquote> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> intNumbers <span class="token operator">=</span> env<span class="token punctuation">.</span>fromElements<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> sum <span class="token operator">=</span> intNumbers<span class="token punctuation">.</span>reduce <span class="token punctuation">(</span>_ <span class="token operator">+</span> _<span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-14-groupreduce-on-full-dataset（完整数据集上的groupreduce）"><a href="#_4-14-groupreduce-on-full-dataset（完整数据集上的groupreduce）" class="header-anchor">#</a> 4.14 GroupReduce on full DataSet（完整数据集上的GroupReduce）</h3> <p>GroupReduce转换在DataSet的所有元素上应用用户定义的group-reduce函数。group-reduce可以迭代DataSet的所有元素并返回任意数量的结果元素</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> input<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>
<span class="token keyword">val</span> output <span class="token operator">=</span> input<span class="token punctuation">.</span>reduceGroup<span class="token punctuation">(</span><span class="token keyword">new</span> MyGroupReducer<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>注意：如果group-reduce函数不可组合，则无法并行完成对完整DataSet的GroupReduce转换。
因此，这可能是非常计算密集的操作。请参阅上面有关“可组合的GroupReduce函数”的段落，以了解如何实现可组合组简化函数。</p></blockquote> <h3 id="_4-15-groupcombine-on-a-full-dataset（完整数据集上的groupcombine）"><a href="#_4-15-groupcombine-on-a-full-dataset（完整数据集上的groupcombine）" class="header-anchor">#</a> 4.15 GroupCombine on a full DataSet（完整数据集上的GroupCombine）</h3> <p>完整数据集上的GroupCombine与分组数据集上的GroupCombine相似。<br>
数据在所有节点上进行分区，然后以贪婪的方式进行组合（即，仅将适合内存的数据进行一次组合）。</p> <h3 id="_4-16-aggregate-on-full-tuple-dataset（完整数据集上聚合）"><a href="#_4-16-aggregate-on-full-tuple-dataset（完整数据集上聚合）" class="header-anchor">#</a> 4.16 Aggregate on full Tuple DataSet（完整数据集上聚合）</h3> <p>聚合转换只能应用于元组数据集。</p> <ul><li>有一些常用的聚合操作。聚合转换提供以下内置聚合功能：</li> <li>Sum</li> <li>Min, and</li> <li>Max</li></ul> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> input<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>
<span class="token keyword">val</span> output <span class="token operator">=</span> input<span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>SUM<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>and<span class="token punctuation">(</span>MIN<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-17-minby-maxby-on-full-tuple-dataset（完整数据集上的minby-maxby）"><a href="#_4-17-minby-maxby-on-full-tuple-dataset（完整数据集上的minby-maxby）" class="header-anchor">#</a> 4.17 MinBy/MaxBy on full Tuple DataSet（完整数据集上的MinBy/MaxBy）</h3> <p>MinBy（MaxBy）转换从元组的数据集中选择一个元组。<br>
选定的元组是其一个或多个指定字段的值最小（最大）的元组。<br>
用于比较的字段必须是有效的关键字段，即可比较的字段。<br>
如果多个元组具有最小（最大）字段值，则返回这些元组中的任意元组。</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> input<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>
<span class="token keyword">val</span> output<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> input                          
                                   <span class="token punctuation">.</span>maxBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// select tuple with maximum values for first and third field.</span>
</code></pre></div><h3 id="_4-18-distinct（去重）"><a href="#_4-18-distinct（去重）" class="header-anchor">#</a> 4.18 Distinct（去重）</h3> <p>Distinct 转换计算源数据集的不同元素的数据集。以下代码从数据集中删除所有重复的元素：</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> input<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>

<span class="token keyword">val</span> output <span class="token operator">=</span> input<span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 所有元组字段</span>
<span class="token keyword">val</span> output <span class="token operator">=</span> input<span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 指定具体元组字段位置</span>
<span class="token keyword">val</span> output <span class="token operator">=</span> input<span class="token punctuation">.</span>distinct <span class="token punctuation">{</span>x <span class="token keyword">=&gt;</span> Math<span class="token punctuation">.</span>abs<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">}</span> <span class="token comment">// 使用  KeySelector 选择器</span>


<span class="token comment">// some ordinary POJO</span>
<span class="token keyword">case</span> <span class="token keyword">class</span> CustomType<span class="token punctuation">(</span>aName <span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> aNumber <span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>

<span class="token keyword">val</span> input<span class="token operator">:</span> DataSet<span class="token punctuation">[</span>CustomType<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>
<span class="token keyword">val</span> output <span class="token operator">=</span> input<span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token string">&quot;aName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;aNumber&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 指定具体字段</span>
<span class="token keyword">val</span> output <span class="token operator">=</span> input<span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token string">&quot;_&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 也可以通过通配符指示使用所有字段：</span>
</code></pre></div><h3 id="_4-19-join"><a href="#_4-19-join" class="header-anchor">#</a> 4.19 Join</h3> <div class="language-scala extra-class"><pre class="language-scala"><code>
</code></pre></div><h3 id="_4-20-outerjoin"><a href="#_4-20-outerjoin" class="header-anchor">#</a> 4.20 OuterJoin</h3> <div class="language-scala extra-class"><pre class="language-scala"><code>
</code></pre></div><h3 id="_4-21-cross"><a href="#_4-21-cross" class="header-anchor">#</a> 4.21 Cross</h3> <p>Cross转换将两个数据集组合为一个数据集。它构建两个输入数据集的元素的所有成对组合，即构建笛卡尔积。<br>
Cross转换要么在每对元素上调用用户定义的交叉函数，要么输出Tuple2</p> <h4 id="cross-with-自定义函数"><a href="#cross-with-自定义函数" class="header-anchor">#</a> Cross with 自定义函数</h4> <div class="language-scala extra-class"><pre class="language-scala"><code>roleLoginDs
    <span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>uid<span class="token punctuation">.</span>equals<span class="token punctuation">(</span><span class="token string">&quot;0|107&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>cross<span class="token punctuation">(</span>userLoginDs<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>uid<span class="token punctuation">.</span>equals<span class="token punctuation">(</span><span class="token string">&quot;0|107&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>c1<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> c2<span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="cross-with-数据集大小预估提示"><a href="#cross-with-数据集大小预估提示" class="header-anchor">#</a> Cross with 数据集大小预估提示</h4> <div class="language-scala extra-class"><pre class="language-scala"><code>  <span class="token comment">// crossWithTiny =&gt; 告诉系统假定右侧比左侧小很多</span>
  roleLoginDs
    <span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>uid<span class="token punctuation">.</span>equals<span class="token punctuation">(</span><span class="token string">&quot;0|107&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>crossWithTiny<span class="token punctuation">(</span>userLoginDs<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>uid<span class="token punctuation">.</span>equals<span class="token punctuation">(</span><span class="token string">&quot;0|107&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>c1<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> c2<span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">// crossWithHuge =&gt; 告诉系统假定左侧比右侧小很多</span>
  roleLoginDs
    <span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>uid<span class="token punctuation">.</span>equals<span class="token punctuation">(</span><span class="token string">&quot;0|107&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>crossWithHuge<span class="token punctuation">(</span>userLoginDs<span class="token punctuation">.</span>filter<span class="token punctuation">(</span>_<span class="token punctuation">.</span>uid<span class="token punctuation">.</span>equals<span class="token punctuation">(</span><span class="token string">&quot;0|107&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token punctuation">(</span>c1<span class="token punctuation">,</span> c2<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>c1<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> c2<span class="token punctuation">.</span>uid<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-22-cogroup"><a href="#_4-22-cogroup" class="header-anchor">#</a> 4.22 CoGroup</h3> <p>CoGroup 转换共同处理两个数据集的组。两个数据集都分组在一个定义的键上，并且两个共享相同键的数据集的组一起交给用户定义的co-group function。<br>
如果对于一个特定的键，只有一个DataSet有一个组，则使用该组和一个空组调用共同组功能。协同功能可以分别迭代两个组的元素并返回任意数量的结果元素。</p> <p>与Reduce，GroupReduce和Join相似，可以使用不同的键选择方法来定义键。</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> iVals<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>
<span class="token keyword">val</span> dVals<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>

<span class="token keyword">val</span> output <span class="token operator">=</span> iVals<span class="token punctuation">.</span>coGroup<span class="token punctuation">(</span>dVals<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>equalTo<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>iVals<span class="token punctuation">,</span> dVals<span class="token punctuation">,</span> out<span class="token operator">:</span> Collector<span class="token punctuation">[</span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span>
    <span class="token keyword">val</span> ints <span class="token operator">=</span> iVals map <span class="token punctuation">{</span> _<span class="token punctuation">.</span>_2 <span class="token punctuation">}</span> toSet

    <span class="token keyword">for</span> <span class="token punctuation">(</span>dVal <span class="token keyword">&lt;-</span> dVals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">&lt;-</span> ints<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        out<span class="token punctuation">.</span>collect<span class="token punctuation">(</span>dVal<span class="token punctuation">.</span>_2 <span class="token operator">*</span> i<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-23-union"><a href="#_4-23-union" class="header-anchor">#</a> 4.23 Union</h3> <p>产生两个必须具有相同类型的数据集的并集。可以通过多个联合调用实现两个以上DataSet的联合</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> vals1<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>
<span class="token keyword">val</span> vals2<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>
<span class="token keyword">val</span> vals3<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>

<span class="token keyword">val</span> unioned <span class="token operator">=</span> vals1<span class="token punctuation">.</span>union<span class="token punctuation">(</span>vals2<span class="token punctuation">)</span><span class="token punctuation">.</span>union<span class="token punctuation">(</span>vals3<span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-24-rebalance-重新平衡"><a href="#_4-24-rebalance-重新平衡" class="header-anchor">#</a> 4.24 Rebalance(重新平衡)</h3> <p>均匀地重新平衡数据集的并行分区，以消除数据偏斜。<br> <strong>重要</strong>：此操作会通过网络重新整理整个DataSet。可能会花费大量时间。</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> in<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>
<span class="token comment">// rebalance DataSet and apply a Map transformation.</span>
<span class="token keyword">val</span> out <span class="token operator">=</span> in<span class="token punctuation">.</span>rebalance<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-25-hash-partition-哈希分区"><a href="#_4-25-hash-partition-哈希分区" class="header-anchor">#</a> 4.25 Hash-Partition(哈希分区)</h3> <p><strong>重要</strong>：此操作会通过网络重新整理整个DataSet。可能会花费大量时间。</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token punctuation">.</span>partitionByHash<span class="token punctuation">(</span>_<span class="token punctuation">.</span>dataUnix<span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-26-range-partition（范围分区）"><a href="#_4-26-range-partition（范围分区）" class="header-anchor">#</a> 4.26 Range-Partition（范围分区）</h3> <p><strong>重要</strong>：此操作需要在DataSet上额外传递一次以计算范围，通过网络对整个DataSet进行边界划分和改组。这会花费大量时间。</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token punctuation">.</span>partitionByRange<span class="token punctuation">(</span>_<span class="token punctuation">.</span>dataUnix<span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-27-sort-partition（分区排序）"><a href="#_4-27-sort-partition（分区排序）" class="header-anchor">#</a> 4.27 Sort Partition（分区排序）</h3> <p>以指定顺序对指定字段上的DataSet的所有分区进行<strong>本地排序</strong>。可以将字段指定为字段表达式或字段位置。<br>
可以通过链接sortPartition()调用在多个字段上对分区进行排序。</p> <div class="language-scala extra-class"><pre class="language-scala"><code>  roleLoginDs
    <span class="token punctuation">.</span>sortPartition<span class="token punctuation">(</span>_<span class="token punctuation">.</span>dataUnix<span class="token punctuation">,</span> Order<span class="token punctuation">.</span>ASCENDING<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>sortPartition<span class="token punctuation">(</span>_<span class="token punctuation">.</span>uid<span class="token punctuation">,</span> Order<span class="token punctuation">.</span>DESCENDING<span class="token punctuation">)</span>
    <span class="token punctuation">.</span>mapPartition<span class="token punctuation">(</span><span class="token punctuation">(</span>values<span class="token operator">:</span> lang<span class="token punctuation">.</span>Iterable<span class="token punctuation">[</span>RolePay<span class="token punctuation">]</span><span class="token punctuation">,</span> out<span class="token operator">:</span> Collector<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
      values<span class="token punctuation">.</span>iterator<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>asScala<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>o <span class="token keyword">=&gt;</span> out<span class="token punctuation">.</span>collect<span class="token punctuation">(</span>o<span class="token punctuation">.</span>rid<span class="token punctuation">,</span> o<span class="token punctuation">.</span>dataUnix<span class="token punctuation">,</span> o<span class="token punctuation">.</span>money<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>print<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="_4-28-first-n（前n个（任意）元素）"><a href="#_4-28-first-n（前n个（任意）元素）" class="header-anchor">#</a> 4.28 First-n（前n个（任意）元素）</h3> <p>返回数据集的前n个（任意）元素。First-n可以应用于常规数据集，分组的数据集或分组排序的数据集。可以将分组键指定为键选择器功能或字段位置键。</p> <div class="language-scala extra-class"><pre class="language-scala"><code><span class="token keyword">val</span> in<span class="token operator">:</span> DataSet<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token comment">// [...]</span>
<span class="token comment">// Return the first five (arbitrary) elements of the DataSet</span>
<span class="token keyword">val</span> out1 <span class="token operator">=</span> in<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

<span class="token comment">// Return the first two (arbitrary) elements of each String group</span>
<span class="token keyword">val</span> out2 <span class="token operator">=</span> in<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment">// Return the first three elements of each String group ordered by the Integer field</span>
<span class="token keyword">val</span> out3 <span class="token operator">=</span> in<span class="token punctuation">.</span>groupBy<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sortGroup<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Order<span class="token punctuation">.</span>ASCENDING<span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/GourdErwa/review-notes/edit/master/framework/flink-basis/DataSet概览.md" target="_blank" rel="noopener noreferrer">帮助我们改善此页面</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最后修改时间:</span> <span class="time">12/8/2019, 5:47:57 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/review-notes/framework/flink-basis/Environment概览.html" class="prev">Environment概览</a></span> <span class="next"><a href="/review-notes/framework/flink-basis/DataSet分配唯一标识符.html">DataSet分配唯一标识符</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/review-notes/assets/js/app.52f4aa5e.js" defer></script><script src="/review-notes/assets/js/2.ab8e20bd.js" defer></script><script src="/review-notes/assets/js/14.c6d9f10f.js" defer></script>
  </body>
</html>
