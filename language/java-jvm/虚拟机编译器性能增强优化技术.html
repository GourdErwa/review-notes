<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>复盘笔记知识分享</title>
    <meta name="description" content="review notes">
    
    
    <link rel="preload" href="/assets/css/0.styles.37ac6e3e.css" as="style"><link rel="preload" href="/assets/js/app.c67d0b80.js" as="script"><link rel="preload" href="/assets/js/2.ead9bc85.js" as="script"><link rel="preload" href="/assets/js/147.1be3a4f7.js" as="script"><link rel="prefetch" href="/assets/js/10.35a4b0d4.js"><link rel="prefetch" href="/assets/js/100.adf8bde7.js"><link rel="prefetch" href="/assets/js/101.ceea563d.js"><link rel="prefetch" href="/assets/js/102.2900d11a.js"><link rel="prefetch" href="/assets/js/103.5af76047.js"><link rel="prefetch" href="/assets/js/104.07450bfb.js"><link rel="prefetch" href="/assets/js/105.adfd89de.js"><link rel="prefetch" href="/assets/js/106.f14ceb9e.js"><link rel="prefetch" href="/assets/js/107.4bae868f.js"><link rel="prefetch" href="/assets/js/108.e5aa0694.js"><link rel="prefetch" href="/assets/js/109.2e4da401.js"><link rel="prefetch" href="/assets/js/11.6346da20.js"><link rel="prefetch" href="/assets/js/110.30f30ead.js"><link rel="prefetch" href="/assets/js/111.0c2e34ff.js"><link rel="prefetch" href="/assets/js/112.19ac8fb3.js"><link rel="prefetch" href="/assets/js/113.12036f5d.js"><link rel="prefetch" href="/assets/js/114.b7c16357.js"><link rel="prefetch" href="/assets/js/115.190de104.js"><link rel="prefetch" href="/assets/js/116.085cd084.js"><link rel="prefetch" href="/assets/js/117.e4ca1a2b.js"><link rel="prefetch" href="/assets/js/118.a397811f.js"><link rel="prefetch" href="/assets/js/119.e9aeb1c8.js"><link rel="prefetch" href="/assets/js/12.d5f7e2e7.js"><link rel="prefetch" href="/assets/js/120.192d2214.js"><link rel="prefetch" href="/assets/js/121.3cb21b38.js"><link rel="prefetch" href="/assets/js/122.668ac5d0.js"><link rel="prefetch" href="/assets/js/123.ac2eae92.js"><link rel="prefetch" href="/assets/js/124.55bf8c88.js"><link rel="prefetch" href="/assets/js/125.24da3bf0.js"><link rel="prefetch" href="/assets/js/126.476736fc.js"><link rel="prefetch" href="/assets/js/127.3c294a71.js"><link rel="prefetch" href="/assets/js/128.59f85d46.js"><link rel="prefetch" href="/assets/js/129.d360f80c.js"><link rel="prefetch" href="/assets/js/13.27908ab5.js"><link rel="prefetch" href="/assets/js/130.0c27ee56.js"><link rel="prefetch" href="/assets/js/131.15db67b8.js"><link rel="prefetch" href="/assets/js/132.6820529f.js"><link rel="prefetch" href="/assets/js/133.00eca67f.js"><link rel="prefetch" href="/assets/js/134.64fe2792.js"><link rel="prefetch" href="/assets/js/135.62396afa.js"><link rel="prefetch" href="/assets/js/136.4a880483.js"><link rel="prefetch" href="/assets/js/137.9f4ab372.js"><link rel="prefetch" href="/assets/js/138.0e141cba.js"><link rel="prefetch" href="/assets/js/139.082c605e.js"><link rel="prefetch" href="/assets/js/14.e01e8e51.js"><link rel="prefetch" href="/assets/js/140.ec5d06d5.js"><link rel="prefetch" href="/assets/js/141.323c7d3a.js"><link rel="prefetch" href="/assets/js/142.0e520fee.js"><link rel="prefetch" href="/assets/js/143.1965d1ed.js"><link rel="prefetch" href="/assets/js/144.94ad0bc0.js"><link rel="prefetch" href="/assets/js/145.792f58a1.js"><link rel="prefetch" href="/assets/js/146.244431a0.js"><link rel="prefetch" href="/assets/js/148.962d6c0d.js"><link rel="prefetch" href="/assets/js/149.a704deb0.js"><link rel="prefetch" href="/assets/js/15.00baee6c.js"><link rel="prefetch" href="/assets/js/150.59778e23.js"><link rel="prefetch" href="/assets/js/151.89a7595f.js"><link rel="prefetch" href="/assets/js/152.9067ad02.js"><link rel="prefetch" href="/assets/js/153.a241596a.js"><link rel="prefetch" href="/assets/js/154.d1f148fb.js"><link rel="prefetch" href="/assets/js/155.7f9f99b2.js"><link rel="prefetch" href="/assets/js/156.34346d62.js"><link rel="prefetch" href="/assets/js/157.0c88c48c.js"><link rel="prefetch" href="/assets/js/158.28e1845e.js"><link rel="prefetch" href="/assets/js/159.64c0173c.js"><link rel="prefetch" href="/assets/js/16.47f23a70.js"><link rel="prefetch" href="/assets/js/160.acd6ab49.js"><link rel="prefetch" href="/assets/js/161.10aaa916.js"><link rel="prefetch" href="/assets/js/162.4ec90f1d.js"><link rel="prefetch" href="/assets/js/163.f6dd80aa.js"><link rel="prefetch" href="/assets/js/164.255ca4f1.js"><link rel="prefetch" href="/assets/js/165.6000cf9d.js"><link rel="prefetch" href="/assets/js/166.d361c86b.js"><link rel="prefetch" href="/assets/js/167.cbc12b04.js"><link rel="prefetch" href="/assets/js/168.53c1d145.js"><link rel="prefetch" href="/assets/js/169.834b19ea.js"><link rel="prefetch" href="/assets/js/17.03fc0941.js"><link rel="prefetch" href="/assets/js/170.6e015c37.js"><link rel="prefetch" href="/assets/js/171.70931c95.js"><link rel="prefetch" href="/assets/js/172.8a57027e.js"><link rel="prefetch" href="/assets/js/173.8892c7f3.js"><link rel="prefetch" href="/assets/js/174.c68316e1.js"><link rel="prefetch" href="/assets/js/175.b0bf87d3.js"><link rel="prefetch" href="/assets/js/176.c11e89d5.js"><link rel="prefetch" href="/assets/js/177.8b37895f.js"><link rel="prefetch" href="/assets/js/178.a2d50750.js"><link rel="prefetch" href="/assets/js/179.52ad16b9.js"><link rel="prefetch" href="/assets/js/18.39270bf0.js"><link rel="prefetch" href="/assets/js/180.e344ddd4.js"><link rel="prefetch" href="/assets/js/181.3a0b8764.js"><link rel="prefetch" href="/assets/js/19.331934e6.js"><link rel="prefetch" href="/assets/js/20.eca56e29.js"><link rel="prefetch" href="/assets/js/21.227d0687.js"><link rel="prefetch" href="/assets/js/22.9919a9d9.js"><link rel="prefetch" href="/assets/js/23.5afcd54b.js"><link rel="prefetch" href="/assets/js/24.12331ac5.js"><link rel="prefetch" href="/assets/js/25.ae4b795e.js"><link rel="prefetch" href="/assets/js/26.8bd48a94.js"><link rel="prefetch" href="/assets/js/27.4bc73d22.js"><link rel="prefetch" href="/assets/js/28.65b3ed12.js"><link rel="prefetch" href="/assets/js/29.51df178a.js"><link rel="prefetch" href="/assets/js/3.88f0e98a.js"><link rel="prefetch" href="/assets/js/30.f14ee968.js"><link rel="prefetch" href="/assets/js/31.9cd7d165.js"><link rel="prefetch" href="/assets/js/32.a6d53df9.js"><link rel="prefetch" href="/assets/js/33.8f6de8c6.js"><link rel="prefetch" href="/assets/js/34.ea14e9e9.js"><link rel="prefetch" href="/assets/js/35.71c703b1.js"><link rel="prefetch" href="/assets/js/36.b37b4801.js"><link rel="prefetch" href="/assets/js/37.31b89f77.js"><link rel="prefetch" href="/assets/js/38.47551654.js"><link rel="prefetch" href="/assets/js/39.f4eb6433.js"><link rel="prefetch" href="/assets/js/4.ad600dda.js"><link rel="prefetch" href="/assets/js/40.d1241810.js"><link rel="prefetch" href="/assets/js/41.cec48606.js"><link rel="prefetch" href="/assets/js/42.152b3248.js"><link rel="prefetch" href="/assets/js/43.8687593b.js"><link rel="prefetch" href="/assets/js/44.728e1027.js"><link rel="prefetch" href="/assets/js/45.9c431a91.js"><link rel="prefetch" href="/assets/js/46.60be1ff6.js"><link rel="prefetch" href="/assets/js/47.c094a5cc.js"><link rel="prefetch" href="/assets/js/48.00912589.js"><link rel="prefetch" href="/assets/js/49.e09be185.js"><link rel="prefetch" href="/assets/js/5.e4ef7fe0.js"><link rel="prefetch" href="/assets/js/50.b71e3ec4.js"><link rel="prefetch" href="/assets/js/51.26320949.js"><link rel="prefetch" href="/assets/js/52.291ee0b7.js"><link rel="prefetch" href="/assets/js/53.78779b54.js"><link rel="prefetch" href="/assets/js/54.f838486f.js"><link rel="prefetch" href="/assets/js/55.aeea620a.js"><link rel="prefetch" href="/assets/js/56.bcae194e.js"><link rel="prefetch" href="/assets/js/57.3679dc21.js"><link rel="prefetch" href="/assets/js/58.4a1ece15.js"><link rel="prefetch" href="/assets/js/59.cb188afc.js"><link rel="prefetch" href="/assets/js/6.bec69e58.js"><link rel="prefetch" href="/assets/js/60.84c0406a.js"><link rel="prefetch" href="/assets/js/61.3210d689.js"><link rel="prefetch" href="/assets/js/62.c0afc7f5.js"><link rel="prefetch" href="/assets/js/63.66ceb028.js"><link rel="prefetch" href="/assets/js/64.c6b374f4.js"><link rel="prefetch" href="/assets/js/65.b8a2b3d9.js"><link rel="prefetch" href="/assets/js/66.e53f086c.js"><link rel="prefetch" href="/assets/js/67.65d8dcd9.js"><link rel="prefetch" href="/assets/js/68.e4e5d39e.js"><link rel="prefetch" href="/assets/js/69.5a91db4c.js"><link rel="prefetch" href="/assets/js/7.7468485a.js"><link rel="prefetch" href="/assets/js/70.7d2cf859.js"><link rel="prefetch" href="/assets/js/71.9ed4e2ec.js"><link rel="prefetch" href="/assets/js/72.ead2a519.js"><link rel="prefetch" href="/assets/js/73.9a2daada.js"><link rel="prefetch" href="/assets/js/74.2aaf6243.js"><link rel="prefetch" href="/assets/js/75.90ede285.js"><link rel="prefetch" href="/assets/js/76.dcba9a83.js"><link rel="prefetch" href="/assets/js/77.d15d4fe6.js"><link rel="prefetch" href="/assets/js/78.37860886.js"><link rel="prefetch" href="/assets/js/79.3994c895.js"><link rel="prefetch" href="/assets/js/8.d29210ea.js"><link rel="prefetch" href="/assets/js/80.2f6dfb65.js"><link rel="prefetch" href="/assets/js/81.0be467be.js"><link rel="prefetch" href="/assets/js/82.356fa6d5.js"><link rel="prefetch" href="/assets/js/83.649e2aa1.js"><link rel="prefetch" href="/assets/js/84.62cfc1d5.js"><link rel="prefetch" href="/assets/js/85.8e21da4a.js"><link rel="prefetch" href="/assets/js/86.b20cab3f.js"><link rel="prefetch" href="/assets/js/87.306ad617.js"><link rel="prefetch" href="/assets/js/88.74cc62aa.js"><link rel="prefetch" href="/assets/js/89.ab0cf415.js"><link rel="prefetch" href="/assets/js/9.bfd5de3a.js"><link rel="prefetch" href="/assets/js/90.32703d66.js"><link rel="prefetch" href="/assets/js/91.b32bb5aa.js"><link rel="prefetch" href="/assets/js/92.0c392bc0.js"><link rel="prefetch" href="/assets/js/93.2020ebf1.js"><link rel="prefetch" href="/assets/js/94.b09ea96a.js"><link rel="prefetch" href="/assets/js/95.e1d424f7.js"><link rel="prefetch" href="/assets/js/96.d4782597.js"><link rel="prefetch" href="/assets/js/97.666964aa.js"><link rel="prefetch" href="/assets/js/98.bfc27790.js"><link rel="prefetch" href="/assets/js/99.3d660fcd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.37ac6e3e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">复盘笔记知识分享</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/java-core/" class="nav-link">Java 核心知识（In review）</a></li><li class="dropdown-item"><!----> <a href="/language/java-concurrency/" class="nav-link">Java 并发编程</a></li><li class="dropdown-item"><!----> <a href="/language/java-jvm/" class="nav-link router-link-active">Java JVM-虚拟机</a></li><li class="dropdown-item"><!----> <a href="/language/scala-basis/" class="nav-link">Scala 基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术框架" class="dropdown-title"><span class="title">技术框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/flink-basis/" class="nav-link">Flink 基础（In review）</a></li></ul></div></div><div class="nav-item"><a href="/interview/" class="nav-link">面试题</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/学习方法.html" class="nav-link">学习方法</a></li><li class="dropdown-item"><!----> <a href="/about/贡献说明.html" class="nav-link">贡献说明</a></li><li class="dropdown-item"><!----> <a href="/about/资源收集清单.html" class="nav-link">资源收集清单</a></li><li class="dropdown-item"><!----> <a href="/about/文档收集清单.html" class="nav-link">文档收集清单</a></li></ul></div></div> <a href="https://github.com/GourdErwa/review-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/java-core/" class="nav-link">Java 核心知识（In review）</a></li><li class="dropdown-item"><!----> <a href="/language/java-concurrency/" class="nav-link">Java 并发编程</a></li><li class="dropdown-item"><!----> <a href="/language/java-jvm/" class="nav-link router-link-active">Java JVM-虚拟机</a></li><li class="dropdown-item"><!----> <a href="/language/scala-basis/" class="nav-link">Scala 基础</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术框架" class="dropdown-title"><span class="title">技术框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/flink-basis/" class="nav-link">Flink 基础（In review）</a></li></ul></div></div><div class="nav-item"><a href="/interview/" class="nav-link">面试题</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/学习方法.html" class="nav-link">学习方法</a></li><li class="dropdown-item"><!----> <a href="/about/贡献说明.html" class="nav-link">贡献说明</a></li><li class="dropdown-item"><!----> <a href="/about/资源收集清单.html" class="nav-link">资源收集清单</a></li><li class="dropdown-item"><!----> <a href="/about/文档收集清单.html" class="nav-link">文档收集清单</a></li></ul></div></div> <a href="https://github.com/GourdErwa/review-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java JVM-内存管理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/language/java-jvm/运行时内存数据区域.html" class="sidebar-link">运行时内存数据区域</a></li><li><a href="/language/java-jvm/引用有什么用.html" class="sidebar-link">引用有什么用</a></li><li><a href="/language/java-jvm/JDK9-类加载机制及双亲委派模式.html" class="sidebar-link">JDK9-类加载机制及双亲委派模式</a></li><li><a href="/language/java-jvm/从虚拟机的角度看对象的创建与访问.html" class="sidebar-link">从虚拟机的角度看对象的创建与访问</a></li><li><a href="/language/java-jvm/从程序员的角度看对象初始化过程与内存分配.html" class="sidebar-link">从程序员的角度看对象初始化过程，变量加载顺序及内存分配</a></li><li><a href="/language/java-jvm/对象的死亡过程.html" class="sidebar-link">对象的死亡过程</a></li><li><a href="/language/java-jvm/垃圾收集算法.html" class="sidebar-link">垃圾收集算法</a></li><li><a href="/language/java-jvm/JDK11-7个垃圾收集器.html" class="sidebar-link">JDK11-7个垃圾收集器</a></li><li><a href="/language/java-jvm/OpenJDK12-Shenandoah收集器.html" class="sidebar-link">OpenJDK 12-Shenandoah 收集器</a></li><li><a href="/language/java-jvm/OracleJDK11-ZGC收集器.html" class="sidebar-link">OracleJDK 11-ZGC 收集器</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java JVM-性能监控、故障处理</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/language/java-jvm/故障诊断-OutOfMemoryError.html" class="sidebar-link">故障诊断-OutOfMemoryError</a></li><li><a href="/language/java-jvm/诊断命令处理工具大全.html" class="sidebar-link">诊断命令处理工具大全</a></li><li><a href="/language/java-jvm/故障诊断-高CPU占用.html" class="sidebar-link">故障诊断-高CPU占用</a></li><li><a href="/language/java-jvm/故障诊断-高内存占用、内存泄漏.html" class="sidebar-link">故障诊断-高内存占用、内存泄漏</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java JVM-虚拟机子系统</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/language/java-jvm/字节码指令-指令表收录.html" class="sidebar-link">字节码指令-指令表收录</a></li><li><a href="/language/java-jvm/运行时栈帧结构.html" class="sidebar-link">运行时栈帧结构</a></li><li><a href="/language/java-jvm/从一段代码分析虚拟机内存分配.html" class="sidebar-link">从一段代码分析虚拟机内存分配</a></li><li><a href="/language/java-jvm/为什么字节码new指令后执行dup指令.html" class="sidebar-link">为什么 new 指令后执行 dup 指令</a></li><li><a href="/language/java-jvm/从方法调用的角度分析重载重写的本质.html" class="sidebar-link">从方法调用的角度分析重载重写的本质</a></li><li><a href="/language/java-jvm/动态方法之方法句柄 MethodHandle.html" class="sidebar-link">动态方法之方法句柄 MethodHandle</a></li><li><a href="/language/java-jvm/动态方法调用指令invokedynamic.html" class="sidebar-link">动态方法调用指令 invokedynamic</a></li><li><a href="/language/java-jvm/代码是怎么运行起来的.html" class="sidebar-link">代码是怎么运行起来的</a></li><li><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html" class="active sidebar-link">虚拟机编译器性能增强优化技术</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html#字符串压缩" class="sidebar-link">字符串压缩</a></li><li class="sidebar-sub-header"><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html#分层编译" class="sidebar-link">分层编译</a></li><li class="sidebar-sub-header"><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html#graal：基于-java-的-jit-编译器" class="sidebar-link">Graal：基于 Java 的 JIT 编译器</a></li><li class="sidebar-sub-header"><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html#提前编译" class="sidebar-link">提前编译</a></li><li class="sidebar-sub-header"><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html#压缩普通对象指针" class="sidebar-link">压缩普通对象指针</a></li><li class="sidebar-sub-header"><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html#逃逸分析" class="sidebar-link">逃逸分析</a></li><li class="sidebar-sub-header"><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html#方法内联" class="sidebar-link">方法内联</a></li><li class="sidebar-sub-header"><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html#公共子表达式消除" class="sidebar-link">公共子表达式消除</a></li><li class="sidebar-sub-header"><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html#数组边界检查消除" class="sidebar-link">数组边界检查消除</a></li><li class="sidebar-sub-header"><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html#参考" class="sidebar-link">参考</a></li><li class="sidebar-sub-header"><a href="/language/java-jvm/虚拟机编译器性能增强优化技术.html#更多相关文章推荐" class="sidebar-link">更多相关文章推荐</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>专栏原创出处：<a href="https://github.com/GourdErwa/review-notes/tree/master/language/java-jvm" target="_blank" rel="noopener noreferrer">github-源笔记文件 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，<a href="https://github.com/GourdErwa/java-advanced/tree/master/java-jvm" target="_blank" rel="noopener noreferrer">github-源码 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，欢迎 Star，转载请附上原文出处链接和本声明。</p></blockquote> <p>Java JVM-虚拟机专栏系列笔记，系统性学习可访问个人复盘笔记-技术博客 <a href="https://review-notes.top/language/java-jvm/" target="_blank" rel="noopener noreferrer">Java JVM-虚拟机 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p></p><div class="table-of-contents"><ul><li><a href="#前言">前言</a></li><li><a href="#字符串压缩">字符串压缩</a></li><li><a href="#分层编译">分层编译</a></li><li><a href="#graal：基于-java-的-jit-编译器">Graal：基于 Java 的 JIT 编译器</a></li><li><a href="#提前编译">提前编译</a></li><li><a href="#压缩普通对象指针">压缩普通对象指针</a></li><li><a href="#逃逸分析">逃逸分析</a></li><li><a href="#方法内联">方法内联</a></li><li><a href="#公共子表达式消除">公共子表达式消除</a></li><li><a href="#数组边界检查消除">数组边界检查消除</a></li><li><a href="#参考">参考</a></li><li><a href="#更多相关文章推荐">更多相关文章推荐</a></li></ul></div><p></p> <h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>介绍 Oracle HotSpot 虚拟机技术的性能增强部分案例。</p> <blockquote><p>优化技术手段非常之多，可参考官方列出 <a href="https://wiki.openjdk.java.net/display/HotSpot/PerformanceTacticIndex" target="_blank" rel="noopener noreferrer">openjdk-优化技术概览 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <h2 id="字符串压缩"><a href="#字符串压缩" class="header-anchor">#</a> 字符串压缩</h2> <p>字符串压缩功能（ <a href="https://openjdk.java.net/jeps/254" target="_blank" rel="noopener noreferrer">JEP 254: Compact Strings<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ）是为了节省内部空间。</p> <p>字符串是 Java 堆用法的主要组成部分，并且大多数 String 对象仅包含 <a href="https://baike.baidu.com/item/latin1/1183590?fr=aladdin" target="_blank" rel="noopener noreferrer">Latin-1<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 字符。此类字符仅需要存储一个字节。
结果，String 没有使用对象内部字符数组中一半的空间。JDK 9 中引入的压缩字符串功能减少了内存占用，并减少了垃圾回收活动。如果您在应用程序中发现性能下降问题，则可以禁用此功能。</p> <p>它将 String 类的内部表示形式从 UTF-16（两个字节）字符数组修改为带有附加字段以标识字符编码的字节数组。其他字符串相关的类，如 AbstractStringBuilder，StringBuilder 和 StringBuffer 更新使用类似的内部表示。</p> <p>在 JDK 9 中，默认情况下启用了压缩字符串功能。因此，String 该类将每个字符的字符存储为一个字节，编码为 Latin-1。附加字符编码字段指示所使用的编码。HotSpot VM 字符串内在函数已更新和优化以支持内部表示。</p> <p>可以通过 <code>-XX:-CompactStrings</code> 在 java 命令行中使用该标志来禁用紧凑字符串功能。禁用此功能后，String 该类将字符存储为两个字节（编码为 UTF-16），并且将 HotSpot VM 字符串内部函数存储为使用 UTF-16 编码。</p> <h2 id="分层编译"><a href="#分层编译" class="header-anchor">#</a> 分层编译</h2> <p>由于即时编译器编译本地代码需要占用程序运行时间，通常要编译出优化程度越高的代码，所花费的时间便会越长；而且想要编译出优化程度更高的代码，解释器可能还要替编译器收集性能监控信息，这对解释执行阶段的速度也有所影响。</p> <p>为了在程序启动响应速度与运行效率之间达到最佳平衡，HotSpot 虚拟机在编译子系统中加入了分层编译的功能：</p> <ul><li><p>第 0 层。程序纯解释执行，并且解释器不开启性能监控功能（Profiling）。</p></li> <li><p>第 1 层。使用客户端编译器将字节码编译为本地代码来运行，进行简单可靠的稳定优化，不开启性能监控功能。</p></li> <li><p>第 2 层。仍然使用客户端编译器执行，仅开启方法及回边次数统计等有限的性能监控功能。</p></li> <li><p>第 3 层。仍然使用客户端编译器执行，开启全部性能监控，除了第 2 层的统计信息外，还会收集如分支跳转、虚方法调用版本等全部的统计信息。</p></li> <li><p>第 4 层。使用服务端编译器将字节码编译为本地代码，相比起客户端编译器，服务端编译器会启用更多编译耗时更长的优化，还会根据性能监控信息进行一些不可靠的激进优化。</p></li></ul> <p>以上层次并不是固定不变的，根据不同的运行参数和版本，虚拟机可以调整分层的数量。</p> <p>通过 <code>-XX:-TieredCompilation</code> 在 java 命令中使用该标志来禁用分层编译。</p> <h2 id="graal：基于-java-的-jit-编译器"><a href="#graal：基于-java-的-jit-编译器" class="header-anchor">#</a> Graal：基于 Java 的 JIT 编译器</h2> <p><a href="http://openjdk.java.net/projects/graal/" target="_blank" rel="noopener noreferrer">Graal<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 是用 Java 编写的高性能优化的即时的编译器，与 Java HotSpot VM 集成在一起。是一个可自定义的动态编译器，我们可以从 Java 调用它。</p> <p>要启用 Graal 作为 JIT 编译器，VM 参数配置：</p> <p><code>-XX:+UnlockExperimentalVMOptions -XX:+UseJVMCICompiler</code></p> <blockquote><p>注意：Graal 是一项实验性功能，仅在 Linux-x64 上受支持。</p></blockquote> <h2 id="提前编译"><a href="#提前编译" class="header-anchor">#</a> 提前编译</h2> <p>提前（AOT，<a href="https://openjdk.java.net/jeps/295" target="_blank" rel="noopener noreferrer">JEP 295: Ahead-of-Time Compilation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ）编译通过在启动虚拟机之前将 Java 类编译为本地代码来缩短大小型 Java 应用程序的启动时间。</p> <p>尽管即时（JIT）编译器速度很快，但是编译大型 Java 程序仍需要时间。此外，当反复解释某些未编译的 Java 方法时，性能会受到影响。AOT 解决了这些问题。</p> <p>语法如下：</p> <div class="language- extra-class"><pre class="language-text"><code>jaotc &lt;options&gt; &lt;list of classes or jar files&gt;
jaotc &lt;options&gt; &lt;--module name&gt;
</code></pre></div><p>示例：</p> <div class="language- extra-class"><pre class="language-text"><code>jaotc --output libHelloWorld.so HelloWorld.class
jaotc --output libjava.base.so --module java.base

java -XX:AOTLibrary=./libHelloWorld.so,./libjava.base.so HelloWorld ————执行应用程序时指定生成的 AOT 库
</code></pre></div><blockquote><p>注意：提前（AOT）编译是一项实验性功能，仅在 Linux-x64 上受支持。</p></blockquote> <h2 id="压缩普通对象指针"><a href="#压缩普通对象指针" class="header-anchor">#</a> 压缩普通对象指针</h2> <p>在 HotSpot 中，oop 或普通对象指针是指向对象的托管指针。<a href="https://wiki.openjdk.java.net/display/HotSpot/CompressedOops" target="_blank" rel="noopener noreferrer">openjdk-CompressedOops<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><strong>1. 为什么要进行指针压缩？</strong></p> <ol><li>在 64 位平台的 HotSpot 中使用 32 位指针，内存使用会多出 1.5 倍左右，使用较大指针在主内存和缓存之间移动数据，占用较大宽带，同时 GC 也会承受较大压力</li> <li>为了减少 64 位平台下内存的消耗，启用指针压缩功能</li> <li>在虚拟机中，32 位地址表示 4G 个对象的指针，在 4G-32G 堆内存范围内，可以通过编码、解码方式进行优化，使得虚拟机可以支持更大的内存配置</li> <li>堆内存小于 4G 时，不需要启用指针压缩，虚拟机会直接去除高 32 位地址，即使用低虚拟地址空间</li> <li>堆内存大于 32G 时，压缩指针会失效，会强制使用 64 位 (即 8 字节) 来对 java 对象寻址，这就会出现 1 的问题，所以堆内存不要大于 32G 为好</li></ol> <p><strong>2. 哪些信息不会被压缩？</strong></p> <ol><li>指向非堆的对象指针</li> <li>局部变量、传参、返回值、NULL 指针</li></ol> <p><strong>3. 指针压缩配置及版本支持</strong>
Java SE 6u23 和更高版本默认情况下支持并启用压缩的 oops。</p> <p>在 Java SE 7 中，默认情况下，-Xmx 未指定时对 64 位 JVM 进程以及-Xmx 小于 32 GB 的值启用压缩 oop 。</p> <p>对于早于 6u23 发行版的 JDK 版本，将该 <code>-XX:+UseCompressedOops</code> 标志与 java 命令一起使用以启用压缩的 oops。</p> <h2 id="逃逸分析"><a href="#逃逸分析" class="header-anchor">#</a> 逃逸分析</h2> <p>逃逸分析（ <a href="https://wiki.openjdk.java.net/display/HotSpot/EscapeAnalysis" target="_blank" rel="noopener noreferrer">openjdk-EscapeAnalysis<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ）的基本原理是：</p> <ul><li>分析对象动态作用域，当一个对象在方法里面被定义后，它可能被外部方法所引用，例如作为调用参数传递到其他方法中，这种称为方法逃逸；</li> <li>甚至还有可能被外部线程访问到，譬如赋值给可以在其他线程中访问的实例变量，这种称为线程逃逸；</li></ul> <p>根据不同的逃逸程度使用不同的优化手段：</p> <ul><li>栈上分配：直接在栈帧上进行对象分配。（不支持线程逃逸）</li> <li>标量替换：类似 java 里面的基础类型不能进一步分解了，被称为标量，如果还能被分解称为聚量。</li> <li>同步状态消除：如果确定一个变量仅被一个线程访问，直接取消同步状态。</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> age<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">String</span> personName<span class="token punctuation">,</span> <span class="token keyword">int</span> personAge<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        name <span class="token operator">=</span> personName<span class="token punctuation">;</span>
        age <span class="token operator">=</span> personAge<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token class-name">Person</span> p<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Employee</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">Person</span> person<span class="token punctuation">;</span>

    <span class="token comment">// person 可能被修改，如果进一步分析调用没有修改 person ，可以直接使用原始的对象</span>
    <span class="token keyword">public</span> <span class="token class-name">Person</span> <span class="token function">getPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span>person<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printEmployeeDetail</span><span class="token punctuation">(</span><span class="token class-name">Employee</span> emp<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Person</span> person <span class="token operator">=</span> emp<span class="token punctuation">.</span><span class="token function">getPerson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// person 不会被修改，我们只需要 person.name/age 两个变量即可</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Employee's name: &quot;</span> <span class="token operator">+</span> person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;; age: &quot;</span> <span class="token operator">+</span> person<span class="token punctuation">.</span><span class="token function">getAge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printEmployeeDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Person</span> person <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> person<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// person 不会逃逸出方法，可以直接优化为 String name = &quot;name&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="方法内联"><a href="#方法内联" class="header-anchor">#</a> 方法内联</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">if</span> <span class="token punctuation">(</span>obj <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;do something&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testInline</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
     <span class="token function">foo</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>我们可以看到 testInline 方法里面的都是无用的代码，但是单独看两个方法时他们又是有意思的。</p> <p>有关内联的实现此处不进行叙述，感兴趣的可以参考文章末位《参考内容》</p> <h2 id="公共子表达式消除"><a href="#公共子表达式消除" class="header-anchor">#</a> 公共子表达式消除</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token punctuation">(</span>c <span class="token operator">*</span> b<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">12</span> <span class="token operator">+</span> a <span class="token operator">+</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> b <span class="token operator">*</span> c<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">--</span> 原始表达式
    
<span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token class-name">E</span> <span class="token operator">*</span> <span class="token number">12</span> <span class="token operator">+</span> a <span class="token operator">+</span> <span class="token punctuation">(</span>a <span class="token operator">+</span> <span class="token class-name">E</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token operator">--</span> 优化为

<span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token class-name">E</span> <span class="token operator">*</span> <span class="token number">13</span> <span class="token operator">+</span> a <span class="token operator">+</span> a<span class="token punctuation">;</span>         <span class="token operator">--</span> 另一种优化（代数简化）
</code></pre></div><h2 id="数组边界检查消除"><a href="#数组边界检查消除" class="header-anchor">#</a> 数组边界检查消除</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>foo <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> foo<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 可能优化为</span>

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> foo<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>segment_fault<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">uncommon_trap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>虚拟机会注册一个 Segment Fault 信号的异常处理器（伪代码中的 uncommon_trap()，务必注意这里是指进程层面的异常处理器，并非真的 Java 的 try-catch 语句的异常处理器），
这样当 foo 不为空的时候，对 value 的访问是不会有任何额外对 foo 判空的开销的，而代价就是当 foo 真的为空时，必须转到异常处理器中恢复中断并抛出 NullPointException 异常。</p> <p>进入异常处理器的过程涉及进程从用户态转到内核态中处理的过程，结束后会再回到用户态，速度远比一次判空检查要慢得多。当 foo 极少为空的时候，隐式异常优化是值得的，但假如 foo 经常为空，这样的优化反而会让程序更慢。
幸好 HotSpot 虚拟机足够聪明，它会根据运行期收集到的性能监控信息自动选择最合适的方案。</p> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li><p><a href="https://docs.oracle.com/en/java/javase/13/vm/java-hotspot-virtual-machine-performance-enhancements.html#GUID-3BB4C26F-6DE7-4299-9329-A3E02620D50A" target="_blank" rel="noopener noreferrer">Oracl 官方虚拟机性能优化介绍-Java HotSpot Virtual Machine Performance Enhancements<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p>《深入理解 Java 虚拟机：JVM 高级特性与最佳实践（第 3 版）》周志明 著</p></li> <li><p><a href="https://docs.oracle.com/cd/E13150_01/jrockit_jvm/jrockit/geninfo/diagnos/underst_jit.html#wp1077986" target="_blank" rel="noopener noreferrer">Oracle 官方对编译器的介绍-Understanding JIT Compilation and Optimizations<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://blog.csdn.net/ignorewho/article/details/80840290" target="_blank" rel="noopener noreferrer">JVM-对象的指针压缩 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul> <h2 id="更多相关文章推荐"><a href="#更多相关文章推荐" class="header-anchor">#</a> 更多相关文章推荐</h2> <ul><li><p><a href="https://blog.csdn.net/xiaohulunb/article/details/103828570" target="_blank" rel="noopener noreferrer">Java JVM（JDK13）-专栏文章目录汇总 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li> <li><p><a href="https://blog.csdn.net/xiaohulunb/article/details/103594468" target="_blank" rel="noopener noreferrer">Java 并发编程-专栏文章目录汇总 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后修改时间:</span> <span class="time">1/20/2020, 9:16:28 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/language/java-jvm/代码是怎么运行起来的.html" class="prev">代码是怎么运行起来的</a></span> <!----></p></div> </main></div><div class="global-ui"><!----><div class="reading-progress top" data-v-56679cca><div class="progress" data-v-56679cca></div></div></div></div>
    <script src="/assets/js/app.c67d0b80.js" defer></script><script src="/assets/js/2.ead9bc85.js" defer></script><script src="/assets/js/147.1be3a4f7.js" defer></script>
  </body>
</html>
