<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>复盘笔记（review-notes）</title>
    <meta name="description" content="review notes">
    
    
    <link rel="preload" href="/assets/css/0.styles.80c3c043.css" as="style"><link rel="preload" href="/assets/js/app.64ee1d62.js" as="script"><link rel="preload" href="/assets/js/2.4b0d762e.js" as="script"><link rel="preload" href="/assets/js/100.30452c64.js" as="script"><link rel="prefetch" href="/assets/js/10.47aedc43.js"><link rel="prefetch" href="/assets/js/101.8373b2d9.js"><link rel="prefetch" href="/assets/js/102.f4ad80b9.js"><link rel="prefetch" href="/assets/js/103.6dec8501.js"><link rel="prefetch" href="/assets/js/104.8c7f13fa.js"><link rel="prefetch" href="/assets/js/105.04d81ff0.js"><link rel="prefetch" href="/assets/js/106.00401ea0.js"><link rel="prefetch" href="/assets/js/107.bf35ff1f.js"><link rel="prefetch" href="/assets/js/108.ecfc0e64.js"><link rel="prefetch" href="/assets/js/109.07176a85.js"><link rel="prefetch" href="/assets/js/11.eac0a935.js"><link rel="prefetch" href="/assets/js/110.9c394c60.js"><link rel="prefetch" href="/assets/js/111.f65430b9.js"><link rel="prefetch" href="/assets/js/112.e538cc38.js"><link rel="prefetch" href="/assets/js/113.019ae583.js"><link rel="prefetch" href="/assets/js/114.818d35c6.js"><link rel="prefetch" href="/assets/js/115.8e6f3de9.js"><link rel="prefetch" href="/assets/js/116.8731c985.js"><link rel="prefetch" href="/assets/js/117.cb6537aa.js"><link rel="prefetch" href="/assets/js/118.a2c03d0d.js"><link rel="prefetch" href="/assets/js/119.f8c09254.js"><link rel="prefetch" href="/assets/js/12.46653b7c.js"><link rel="prefetch" href="/assets/js/120.e09d2930.js"><link rel="prefetch" href="/assets/js/121.b5153c6f.js"><link rel="prefetch" href="/assets/js/122.a5ce44c2.js"><link rel="prefetch" href="/assets/js/123.1000acdf.js"><link rel="prefetch" href="/assets/js/124.9e66d55e.js"><link rel="prefetch" href="/assets/js/125.99d22f51.js"><link rel="prefetch" href="/assets/js/126.ba937f3a.js"><link rel="prefetch" href="/assets/js/127.f68387d7.js"><link rel="prefetch" href="/assets/js/128.25fc0676.js"><link rel="prefetch" href="/assets/js/129.143f2a89.js"><link rel="prefetch" href="/assets/js/13.ba56a81f.js"><link rel="prefetch" href="/assets/js/130.2208b1d2.js"><link rel="prefetch" href="/assets/js/131.6575c94d.js"><link rel="prefetch" href="/assets/js/132.9d04eacd.js"><link rel="prefetch" href="/assets/js/133.c7e7115a.js"><link rel="prefetch" href="/assets/js/134.0906bbba.js"><link rel="prefetch" href="/assets/js/135.883e248d.js"><link rel="prefetch" href="/assets/js/136.7b6468c4.js"><link rel="prefetch" href="/assets/js/137.6aa3166e.js"><link rel="prefetch" href="/assets/js/138.bbb3305d.js"><link rel="prefetch" href="/assets/js/139.ecc67aaa.js"><link rel="prefetch" href="/assets/js/14.dc25140f.js"><link rel="prefetch" href="/assets/js/140.df4c8f71.js"><link rel="prefetch" href="/assets/js/141.40ab428b.js"><link rel="prefetch" href="/assets/js/142.ad359cd9.js"><link rel="prefetch" href="/assets/js/143.aed7cc09.js"><link rel="prefetch" href="/assets/js/144.40e4f1df.js"><link rel="prefetch" href="/assets/js/145.0fc1e9ce.js"><link rel="prefetch" href="/assets/js/146.c0b92dfd.js"><link rel="prefetch" href="/assets/js/147.df02143e.js"><link rel="prefetch" href="/assets/js/148.770774bb.js"><link rel="prefetch" href="/assets/js/149.672df14f.js"><link rel="prefetch" href="/assets/js/15.31d9e5d6.js"><link rel="prefetch" href="/assets/js/150.68a35991.js"><link rel="prefetch" href="/assets/js/151.e18806df.js"><link rel="prefetch" href="/assets/js/152.afadf1a1.js"><link rel="prefetch" href="/assets/js/153.a9f86443.js"><link rel="prefetch" href="/assets/js/154.b57196b2.js"><link rel="prefetch" href="/assets/js/155.32c52bb3.js"><link rel="prefetch" href="/assets/js/16.a8089c78.js"><link rel="prefetch" href="/assets/js/17.9ffedffc.js"><link rel="prefetch" href="/assets/js/18.3cd68aa3.js"><link rel="prefetch" href="/assets/js/19.c06ab09d.js"><link rel="prefetch" href="/assets/js/20.65604da0.js"><link rel="prefetch" href="/assets/js/21.9f35412d.js"><link rel="prefetch" href="/assets/js/22.96842dc9.js"><link rel="prefetch" href="/assets/js/23.ef6585a1.js"><link rel="prefetch" href="/assets/js/24.ab0a4074.js"><link rel="prefetch" href="/assets/js/25.55e21246.js"><link rel="prefetch" href="/assets/js/26.31d67724.js"><link rel="prefetch" href="/assets/js/27.cfe8ffbf.js"><link rel="prefetch" href="/assets/js/28.0b5f89f5.js"><link rel="prefetch" href="/assets/js/29.cc0c7700.js"><link rel="prefetch" href="/assets/js/3.237271f6.js"><link rel="prefetch" href="/assets/js/30.44c4b812.js"><link rel="prefetch" href="/assets/js/31.1512653a.js"><link rel="prefetch" href="/assets/js/32.c1c5142a.js"><link rel="prefetch" href="/assets/js/33.a9eeb32d.js"><link rel="prefetch" href="/assets/js/34.4c0c18ab.js"><link rel="prefetch" href="/assets/js/35.bcf0aa80.js"><link rel="prefetch" href="/assets/js/36.e41476ea.js"><link rel="prefetch" href="/assets/js/37.2ab49744.js"><link rel="prefetch" href="/assets/js/38.3d5170c4.js"><link rel="prefetch" href="/assets/js/39.4af04d32.js"><link rel="prefetch" href="/assets/js/4.bbd27402.js"><link rel="prefetch" href="/assets/js/40.b884713c.js"><link rel="prefetch" href="/assets/js/41.2169bf93.js"><link rel="prefetch" href="/assets/js/42.e7392a4e.js"><link rel="prefetch" href="/assets/js/43.bf7c799b.js"><link rel="prefetch" href="/assets/js/44.1fda14cf.js"><link rel="prefetch" href="/assets/js/45.d4736b46.js"><link rel="prefetch" href="/assets/js/46.9a56b4aa.js"><link rel="prefetch" href="/assets/js/47.dfcbc59f.js"><link rel="prefetch" href="/assets/js/48.a943b6e2.js"><link rel="prefetch" href="/assets/js/49.e5833f46.js"><link rel="prefetch" href="/assets/js/5.457457bf.js"><link rel="prefetch" href="/assets/js/50.dc830b7a.js"><link rel="prefetch" href="/assets/js/51.d99e7b5b.js"><link rel="prefetch" href="/assets/js/52.4dbe93ad.js"><link rel="prefetch" href="/assets/js/53.4ac5e69c.js"><link rel="prefetch" href="/assets/js/54.f422d805.js"><link rel="prefetch" href="/assets/js/55.4d1fbcd4.js"><link rel="prefetch" href="/assets/js/56.b8fc9f68.js"><link rel="prefetch" href="/assets/js/57.94839b9a.js"><link rel="prefetch" href="/assets/js/58.932ede56.js"><link rel="prefetch" href="/assets/js/59.e21c916c.js"><link rel="prefetch" href="/assets/js/6.0154874c.js"><link rel="prefetch" href="/assets/js/60.c4e3f0f8.js"><link rel="prefetch" href="/assets/js/61.9fd73b64.js"><link rel="prefetch" href="/assets/js/62.94dfc585.js"><link rel="prefetch" href="/assets/js/63.124c9040.js"><link rel="prefetch" href="/assets/js/64.ec025119.js"><link rel="prefetch" href="/assets/js/65.0eb0a1d6.js"><link rel="prefetch" href="/assets/js/66.0951a664.js"><link rel="prefetch" href="/assets/js/67.cdefd629.js"><link rel="prefetch" href="/assets/js/68.3e82f54e.js"><link rel="prefetch" href="/assets/js/69.8a73afe5.js"><link rel="prefetch" href="/assets/js/7.0f8ba566.js"><link rel="prefetch" href="/assets/js/70.26ce0475.js"><link rel="prefetch" href="/assets/js/71.d3648a96.js"><link rel="prefetch" href="/assets/js/72.f3e0ba6d.js"><link rel="prefetch" href="/assets/js/73.eb3dc62f.js"><link rel="prefetch" href="/assets/js/74.5e5c283b.js"><link rel="prefetch" href="/assets/js/75.77130e06.js"><link rel="prefetch" href="/assets/js/76.46afc090.js"><link rel="prefetch" href="/assets/js/77.df8b246c.js"><link rel="prefetch" href="/assets/js/78.70232e0a.js"><link rel="prefetch" href="/assets/js/79.3a19bfe0.js"><link rel="prefetch" href="/assets/js/8.ae7016e7.js"><link rel="prefetch" href="/assets/js/80.5b5500d0.js"><link rel="prefetch" href="/assets/js/81.d5baa202.js"><link rel="prefetch" href="/assets/js/82.0de1ff3d.js"><link rel="prefetch" href="/assets/js/83.7a550ce6.js"><link rel="prefetch" href="/assets/js/84.4dc75321.js"><link rel="prefetch" href="/assets/js/85.e774924a.js"><link rel="prefetch" href="/assets/js/86.e894324e.js"><link rel="prefetch" href="/assets/js/87.2f988fd2.js"><link rel="prefetch" href="/assets/js/88.c32b4c66.js"><link rel="prefetch" href="/assets/js/89.eb6dc31a.js"><link rel="prefetch" href="/assets/js/9.d3350fde.js"><link rel="prefetch" href="/assets/js/90.c9b3fa2a.js"><link rel="prefetch" href="/assets/js/91.2ea29860.js"><link rel="prefetch" href="/assets/js/92.7ec03460.js"><link rel="prefetch" href="/assets/js/93.571d1a36.js"><link rel="prefetch" href="/assets/js/94.00ef9d44.js"><link rel="prefetch" href="/assets/js/95.98e072d6.js"><link rel="prefetch" href="/assets/js/96.5d5dd254.js"><link rel="prefetch" href="/assets/js/97.6864536b.js"><link rel="prefetch" href="/assets/js/98.a0fad21f.js"><link rel="prefetch" href="/assets/js/99.0bdb6013.js">
    <link rel="stylesheet" href="/assets/css/0.styles.80c3c043.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">复盘笔记（review-notes）</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/java-core/" class="nav-link">Java 核心知识（In review）</a></li><li class="dropdown-item"><!----> <a href="/language/java-concurrency/" class="nav-link router-link-active">Java 并发编程</a></li><li class="dropdown-item"><!----> <a href="/language/java-jvm/" class="nav-link">Java 虚拟机（JVM）（In review）</a></li><li class="dropdown-item"><!----> <a href="/language/scala-basis/" class="nav-link">Scala 基础（In review）</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术框架" class="dropdown-title"><span class="title">技术框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/flink-basis/" class="nav-link">Flink 基础（In review）</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试题" class="dropdown-title"><span class="title">面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/java/" class="nav-link">Java 面试题</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/学习方法.html" class="nav-link">学习方法</a></li><li class="dropdown-item"><!----> <a href="/about/贡献说明.html" class="nav-link">贡献说明</a></li></ul></div></div> <a href="https://github.com/GourdErwa/review-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="编程语言" class="dropdown-title"><span class="title">编程语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/language/java-core/" class="nav-link">Java 核心知识（In review）</a></li><li class="dropdown-item"><!----> <a href="/language/java-concurrency/" class="nav-link router-link-active">Java 并发编程</a></li><li class="dropdown-item"><!----> <a href="/language/java-jvm/" class="nav-link">Java 虚拟机（JVM）（In review）</a></li><li class="dropdown-item"><!----> <a href="/language/scala-basis/" class="nav-link">Scala 基础（In review）</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术框架" class="dropdown-title"><span class="title">技术框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/flink-basis/" class="nav-link">Flink 基础（In review）</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试题" class="dropdown-title"><span class="title">面试题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/java/" class="nav-link">Java 面试题</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="关于" class="dropdown-title"><span class="title">关于</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/about/学习方法.html" class="nav-link">学习方法</a></li><li class="dropdown-item"><!----> <a href="/about/贡献说明.html" class="nav-link">贡献说明</a></li></ul></div></div> <a href="https://github.com/GourdErwa/review-notes" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java 并发编程-基础</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/language/java-concurrency/内存模型-基础概念.html" class="sidebar-link">内存模型-基础概念</a></li><li><a href="/language/java-concurrency/内存模型-顺序一致性.html" class="sidebar-link">内存模型-顺序一致性</a></li><li><a href="/language/java-concurrency/并发编程-CAS实现原理.html" class="sidebar-link">CAS实现原理</a></li><li><a href="/language/java-concurrency/内存模型-原子操作.html" class="sidebar-link">原子操作</a></li><li><a href="/language/java-concurrency/内存模型-final域的内存语义.html" class="sidebar-link">final域的内存语义</a></li><li><a href="/language/java-concurrency/并发关键字-volatile.html" class="sidebar-link">并发关键字-volatile</a></li><li><a href="/language/java-concurrency/并发关键字-synchronized.html" class="sidebar-link">并发关键字-synchronized</a></li><li><a href="/language/java-concurrency/锁的内存语义.html" class="sidebar-link">锁的内存语义</a></li><li><a href="/language/java-concurrency/并发操作比较（CAS、volatile、synchronized、Lock）.html" class="sidebar-link">并发操作比较（CAS、volatile、synchronized、Lock）</a></li><li><a href="/language/java-concurrency/原子操作类（atomic包）.html" class="sidebar-link">原子操作类（atomic包）</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Java 并发编程-线程</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/language/java-concurrency/线程简介.html" class="active sidebar-link">线程简介</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/language/java-concurrency/线程简介.html#什么是线程" class="sidebar-link">什么是线程</a></li><li class="sidebar-sub-header"><a href="/language/java-concurrency/线程简介.html#为什么要用线程" class="sidebar-link">为什么要用线程</a></li><li class="sidebar-sub-header"><a href="/language/java-concurrency/线程简介.html#线程优先级" class="sidebar-link">线程优先级</a></li><li class="sidebar-sub-header"><a href="/language/java-concurrency/线程简介.html#线程状态" class="sidebar-link">线程状态</a></li><li class="sidebar-sub-header"><a href="/language/java-concurrency/线程简介.html#daemon-线程" class="sidebar-link">Daemon 线程</a></li><li class="sidebar-sub-header"><a href="/language/java-concurrency/线程简介.html#线程的初始化、启动、中断、停止" class="sidebar-link">线程的初始化、启动、中断、停止</a></li><li class="sidebar-sub-header"><a href="/language/java-concurrency/线程简介.html#过期的-suspend、resume-和-stop" class="sidebar-link">过期的 suspend、resume 和 stop</a></li><li class="sidebar-sub-header"><a href="/language/java-concurrency/线程简介.html#线程-join" class="sidebar-link">线程 join</a></li><li class="sidebar-sub-header"><a href="/language/java-concurrency/线程简介.html#线程通信" class="sidebar-link">线程通信</a></li><li class="sidebar-sub-header"><a href="/language/java-concurrency/线程简介.html#总结思考" class="sidebar-link">总结思考</a></li><li class="sidebar-sub-header"><a href="/language/java-concurrency/线程简介.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/language/java-concurrency/线程等待通知机制（wait、notify）.html" class="sidebar-link">线程等待通知机制（wait、notify）</a></li><li><a href="/language/java-concurrency/线程等待操作比较（sleep、wait、park、Condition）.html" class="sidebar-link">线程等待操作比较（sleep、wait、park、Condition）</a></li><li><a href="/language/java-concurrency/线程关键类-ThreadLocal.html" class="sidebar-link">线程关键类-ThreadLocal</a></li><li><a href="/language/java-concurrency/线程池简介.html" class="sidebar-link">线程池简介</a></li><li><a href="/language/java-concurrency/线程池-Executor框架.html" class="sidebar-link">线程池-Executor框架</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java 并发编程-锁</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/language/java-concurrency/锁-Lock接口简介.html" class="sidebar-link">锁-Lock接口简介</a></li><li><a href="/language/java-concurrency/锁-AbstractQueuedSynchronizer介绍.html" class="sidebar-link">锁-AbstractQueuedSynchronizer介绍</a></li><li><a href="/language/java-concurrency/锁-AbstractQueuedSynchronizer原理.html" class="sidebar-link">锁-AbstractQueuedSynchronizer原理</a></li><li><a href="/language/java-concurrency/锁-重入锁（ReentrantLock）.html" class="sidebar-link">锁-重入锁（ReentrantLock）</a></li><li><a href="/language/java-concurrency/锁-读写锁（ReentrantReadWriteLock）.html" class="sidebar-link">锁-读写锁（ReentrantReadWriteLock）</a></li><li><a href="/language/java-concurrency/锁相关工具类（LockSupport）.html" class="sidebar-link">锁相关工具类（LockSupport）</a></li><li><a href="/language/java-concurrency/锁等待通知机制（Condition）.html" class="sidebar-link">锁等待通知机制（Condition）</a></li><li><a href="/language/java-concurrency/锁-死锁问题及解决方案.html" class="sidebar-link">锁-死锁问题及解决方案</a></li><li><a href="/language/java-concurrency/锁类型总结.html" class="sidebar-link">锁类型总结</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Java 并发编程-容器和工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/language/java-concurrency/并发容器-阻塞队列.html" class="sidebar-link">并发容器-阻塞队列</a></li><li><a href="/language/java-concurrency/jdk1.8-ConcurrentHashMap.html" class="sidebar-link">jdk1.8-ConcurrentHashMap</a></li><li><a href="/language/java-concurrency/并发容器-ConcurrentLinkedQueue.html" class="sidebar-link">并发容器-ConcurrentLinkedQueue</a></li><li><a href="/language/java-concurrency/并行任务框架-ForkJoin.html" class="sidebar-link">并行任务框架-ForkJoin</a></li><li><a href="/language/java-concurrency/等待多线程完成-CountDownLatch.html" class="sidebar-link">等待多线程完成-CountDownLatch</a></li><li><a href="/language/java-concurrency/同步屏障-CyclicBarrier.html" class="sidebar-link">同步屏障-CyclicBarrier</a></li><li><a href="/language/java-concurrency/控制并发数的信号量-Semaphore.html" class="sidebar-link">控制并发数的信号量-Semaphore</a></li><li><a href="/language/java-concurrency/线程交换数据-Exchanger.html" class="sidebar-link">线程交换数据-Exchanger</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><blockquote><p>专栏原创出处：<a href="https://github.com/GourdErwa/review-notes/tree/master/language/java-concurrency" target="_blank" rel="noopener noreferrer">github-源笔记文件 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ，<a href="https://github.com/GourdErwa/java-advanced/tree/master/java-concurrency" target="_blank" rel="noopener noreferrer">github-源码 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，欢迎 Star，转载请附上原文出处链接和本声明。</p></blockquote> <p>Java 并发编程专栏系列笔记，系统性学习可访问个人复盘笔记-技术博客 <a href="https://review-notes.top/language/java-concurrency/" target="_blank" rel="noopener noreferrer">Java 并发编程<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p></p><div class="table-of-contents"><ul><li><a href="#什么是线程">什么是线程</a></li><li><a href="#为什么要用线程">为什么要用线程</a></li><li><a href="#线程优先级">线程优先级</a></li><li><a href="#线程状态">线程状态</a></li><li><a href="#daemon-线程">Daemon 线程</a></li><li><a href="#线程的初始化、启动、中断、停止">线程的初始化、启动、中断、停止</a><ul><li><a href="#初始化线程（init）">初始化线程（init）</a></li><li><a href="#启动线程（start）">启动线程（start）</a></li><li><a href="#中断线程（interrupt）">中断线程（interrupt）</a></li><li><a href="#停止线程">停止线程</a></li></ul></li><li><a href="#过期的-suspend、resume-和-stop">过期的 suspend、resume 和 stop</a></li><li><a href="#线程-join">线程 join</a></li><li><a href="#线程通信">线程通信</a></li><li><a href="#总结思考">总结思考</a></li><li><a href="#参考">参考</a></li></ul></div><p></p> <h2 id="什么是线程"><a href="#什么是线程" class="header-anchor">#</a> 什么是线程</h2> <p>什么是进程：现代操作系统在运行一个程序时，会为其创建一个进程。例如，启动一个 Java 程序，操作系统就会创建一个 Java 进程。</p> <p>什么是线程：现代操作系统调度的最小单元是线程，也叫轻量级进程，在一个进程里可以创建多个线程，这些线程都拥有各自的计数器、堆栈和局部变量等属性，并且能够访问共享的内存变量。</p> <h2 id="为什么要用线程"><a href="#为什么要用线程" class="header-anchor">#</a> 为什么要用线程</h2> <ul><li>更多的处理器核心（利用处理器高频多核心优势）</li> <li>更快的响应时间（并行计算）</li> <li>更好的编程模型（方便开发人员编程）</li></ul> <h2 id="线程优先级"><a href="#线程优先级" class="header-anchor">#</a> 线程优先级</h2> <p>现代操作系统基本采用时分的形式调度运行的线程，操作系统会分出一个个时间片，线程会分配到若干时间片，当线程的时间片用完了就会发生线程调度，并等待着下次分配。线程分配到的时间片多少也就决定了线程使用处理器资源的多少，而线程优先级就是决定线程需要多或者少分配一些处理器资源的线程属性。
 </p> <ol><li>如何控制优先级？</li></ol> <p>通过 setPriority(int) 方法来修改优先级，默认优先级是 5（范围从 1~10），优先级高的线程分配时间片的数量要多于优先级低的线程。</p> <ol start="2"><li>设置线程优先级时考虑情况：</li></ol> <ul><li>频繁阻塞 (休眠或者 I/O 操作) 的线程需要设置较高优先级</li> <li>偏重计算 (需要较多 CPU 时间或者偏运算) 的线程则设置较低的优先级，确保处理器不会被独占</li></ul> <ol start="3"><li>注意</li></ol> <p>线程优先级不能作为程序正确性的依赖，因为操作系统可以完全不用理会 Java 线程对于优先级的设定。</p> <h2 id="线程状态"><a href="#线程状态" class="header-anchor">#</a> 线程状态</h2> <ul><li>初始状态（NEW）</li></ul> <p>尚未启动的线程处于此状态。</p> <ul><li><p>就绪状态（除CPU之外，其它的运行所需资源都已全部获得）</p> <ul><li>调用线程的 start 方法，此线程进入就绪状态。</li> <li>当前线程 sleep 方法结束，其他线程 join 结束，等待用户输入完毕，某个线程拿到对象锁，这些线程也将进入就绪状态。</li> <li>当前线程时间片用完了，调用当前线程的 yield 方法，当前线程进入就绪状态。</li> <li>锁池里的线程拿到对象锁后，进入就绪状态。</li></ul></li> <li><p>运行中状态（RUNNABLE）</p></li></ul> <p>线程调度程序从可运行池中选择一个线程作为当前线程时，当前线程线程所处的状态就是运行状态。（JDK 把就绪状态归于 RUNNABLE 状态）</p> <ul><li>阻塞状态（BLOCKED）</li></ul> <p>阻塞状态是线程阻塞在等待监视器的状态。</p> <ul><li>等待（WAITING）</li></ul> <p>处于这种状态的线程不会被分配 CPU 执行时间，它们要等待被显式地做出一些动作（通知或者中断），否则会处于无限期等待的状态。</p> <ul><li>超时等待（TIMED_WAITING）</li></ul> <p>处于这种状态的线程不会被分配 CPU 执行时间，不过无须无限期等待被其他线程显示地唤醒，在达到一定时间后它们会自动唤醒。</p> <ul><li>终止状态（TERMINATED）</li></ul> <p>当线程的 run 方法完成时，或者主线程的 main 方法完成时，我们就认为它终止了。这个线程对象也许是活的，但是，它已经不是一个单独执行的线程。线程一旦终止了，就不能复生。
在一个终止的线程上调用 start 方法，会抛出 java.lang.IllegalThreadStateException 异常。</p> <hr> <div align="center"><img src="https://blog-review-notes.oss-cn-beijing.aliyuncs.com/language/java-concurrency/_images/线程状态变迁.png"> <p> 线程状态变迁 </p></div> <h2 id="daemon-线程"><a href="#daemon-线程" class="header-anchor">#</a> Daemon 线程</h2> <p>Daemon 线程是一种支持型线程，因为它主要被用作程序中后台调度以及支持性工作。当一个 Java 虚拟机中不存在非 Daemon 线程的时候，Java 虚拟机将会退出。可以通过调用 Thread.setDaemon(true) 将线程设置为 Daemon 线程。</p> <div class="custom-block warning"><p class="custom-block-title">WARNING</p> <ul><li>Daemon 属性需要在启动线程之前设置，不能在启动线程之后设置</li> <li>Java 虚拟机退出时 Daemon 线程中的 finally 块并不一定会执行 (Java 虚拟机中的所有 Daemon 线程都需要立即终止)</li> <li>不能依靠 finally 块中的内容来确保执行关闭或清理资源</li></ul></div> <h2 id="线程的初始化、启动、中断、停止"><a href="#线程的初始化、启动、中断、停止" class="header-anchor">#</a> 线程的初始化、启动、中断、停止</h2> <h3 id="初始化线程（init）"><a href="#初始化线程（init）" class="header-anchor">#</a> 初始化线程（init）</h3> <p>线程类 Thread 构造函数最终调用 init 方法如下：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token class-name">ThreadGroup</span> g<span class="token punctuation">,</span> <span class="token class-name">Runnable</span> target<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">,</span>
                      <span class="token keyword">long</span> stackSize<span class="token punctuation">,</span> <span class="token class-name">AccessControlContext</span> acc<span class="token punctuation">,</span>
                      <span class="token keyword">boolean</span> inheritThreadLocals<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">(</span><span class="token string">&quot;name cannot be null&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span> <span class="token comment">// 线程名称</span>

        <span class="token class-name">Thread</span> parent <span class="token operator">=</span> <span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 当前线程就是该线程的父线程</span>

        g<span class="token punctuation">.</span><span class="token function">addUnstarted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">this</span><span class="token punctuation">.</span>group <span class="token operator">=</span> g<span class="token punctuation">;</span>  <span class="token comment">// 设置所属线程组</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>daemon <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">isDaemon</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将 daemon 属性设置为父线程的对应属性</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>priority <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">getPriority</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将 priority 属性设置为父线程的对应属性</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>security <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token function">isCCLOverridden</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>contextClassLoader <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>contextClassLoader <span class="token operator">=</span> parent<span class="token punctuation">.</span>contextClassLoader<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>inheritedAccessControlContext <span class="token operator">=</span>
                acc <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> acc <span class="token operator">:</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
        <span class="token function">setPriority</span><span class="token punctuation">(</span>priority<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>inheritThreadLocals <span class="token operator">&amp;&amp;</span> parent<span class="token punctuation">.</span>inheritableThreadLocals <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>inheritableThreadLocals <span class="token operator">=</span>
                <span class="token class-name">ThreadLocal</span><span class="token punctuation">.</span><span class="token function">createInheritedMap</span><span class="token punctuation">(</span>parent<span class="token punctuation">.</span>inheritableThreadLocals<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>stackSize <span class="token operator">=</span> stackSize<span class="token punctuation">;</span> <span class="token comment">// 存放指定的堆栈大小，零表示该参数将被忽略</span>

        tid <span class="token operator">=</span> <span class="token function">nextThreadID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 分配一个线程 ID</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="启动线程（start）"><a href="#启动线程（start）" class="header-anchor">#</a> 启动线程（start）</h3> <p>线程对象在初始化完成之后，调用 start 方法就可以启动这个线程。</p> <p>线程 start 方法的含义是：当前线程 (即 parent 线程) 同步告知 Java 虚拟机，只要线程规划器空闲，应立即启动调用 start 方法的线程。</p> <p><code>public class Thread implements Runnable</code> ， Runnable 接口中只有一个 run 方法。一个类实现 Runnable 接口后，并不代表该类是一个“线程”类，不能直接运行，必须通过 Thread 实例才能创建并运行线程。</p> <p>Thread.start 方法源码：</p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>threadStatus <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalThreadStateException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        group<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">boolean</span> started <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">start0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            started <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>started<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    group<span class="token punctuation">.</span><span class="token function">threadStartFailed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> ignore<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">/* do nothing. If start0 threw a Throwable then
                  it will be passed up the call stack */</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">native</span> <span class="token keyword">void</span> <span class="token function">start0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 最终底层调用启动线程</span>
</code></pre></div><h3 id="中断线程（interrupt）"><a href="#中断线程（interrupt）" class="header-anchor">#</a> 中断线程（interrupt）</h3> <p>中断可以理解为线程的一个标识位属性，它表示一个运行中的线程是否被其他线程进行了中断操作。中断好比其他线程对该线程打了个招呼，其他线程通过调用该线程的 interrupt 方法对其进行中断操作。
线程通过检查自身是否被中断来进行响应，线程通过方法 isInterrupted 来进行判断是否被中断，也可以调用静态方法 Thread.interrupted 对当前线程的中断标识位进行复位。如果该线程已经处于终结状态，即使该线程被中断过，在调用该线程对象的 isInterrupted 时依旧会返回 false。</p> <ol><li>中断状态设置情况：</li></ol> <ul><li>如果该线程调用 Object.wait 被阻塞，或者调用 Thread.join ， Thread.sleep 方法，那么它的中断状态将被清除，同时抛出 InterruptedException</li> <li>如果该线程被阻塞在 I/O 操作 InterruptibleChannel ，则信道被关闭，该线程设置为中断状态，同时抛出 java.nio.channels.ClosedByInterruptException</li> <li>如果这个线程被阻塞在 java.nio.channels.Selector，该线程设置为中断状态</li> <li>许多声明抛出 InterruptedException 的方法 (例如 Thread.sleep(long millis) 方法) 这些方法在抛出 InterruptedException 之前，Java 虚拟机会先将该线程的中断标识位清除，然后抛出 InterruptedException，此时调用 isInterrupted 方法将会返回 false</li> <li>中断一个不存在的线程不会有任何效果</li></ul> <ol start="2"><li>为什么需要中断</li></ol> <ul><li>线程运行过程中，我们根据实际需求需要中断线程执行</li> <li>处理器等其他外界条件让线程不能正常运行下去</li></ul> <ol start="3"><li>中断操作会让线程停止吗？
不会，中断仅仅是一个状态值，可能会抛出异常（参考中断状态设置情况）</li></ol> <h3 id="停止线程"><a href="#停止线程" class="header-anchor">#</a> 停止线程</h3> <ul><li>线程运行代码中设置标识符，通过标识符判断退出</li> <li>调用中断方法，代码逻辑中判断是否中断或者捕获中断相关异常后退出</li></ul> <h2 id="过期的-suspend、resume-和-stop"><a href="#过期的-suspend、resume-和-stop" class="header-anchor">#</a> 过期的 suspend、resume 和 stop</h2> <p>suspend、resume 和 stop 方法分别致使线程暂停、恢复和终止工作</p> <p>不建议使用的原因主要有:</p> <ul><li>suspend/resume 方法，在调用后，线程不会释放已经占有的资源 (比如锁)，而是占有着资源进入睡眠状态，这样容易引发死锁问题。</li> <li>stop 方法，在终结一个线程时不会保证线程的资源正常释放，通常是没有给予线程完成资源释放工作的机会，因此会导致程序可能工作在不确定状态下。</li></ul> <p>注意：<br>
正因为 suspend、resume 和 stop 方法带来的副作用，这些方法才被标注为不建议使用的过期方法，而暂停和恢复操作可以用后面提到的 <em>《线程等待通知机制》</em> 来替代。</p> <p>详细原因可参考 <a href="https://docs.oracle.com/javase/8/docs/technotes/guides/concurrency/threadPrimitiveDeprecation.html" target="_blank" rel="noopener noreferrer">Why are Thread.stop, Thread.suspend and Thread.resume Deprecated?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="线程-join"><a href="#线程-join" class="header-anchor">#</a> 线程 join</h2> <p>如果一个线程 A 执行了 thread.join 语句，其含义是:当前线程 A 等待 thread 线程终止之后才从 thread.join 返回。</p> <p>线程 Thread 除了提供 join 方法之外，还提供了 join(long millis) 和 join(long millis,int nanos) 两个具备超时特性的方法。这两个超时方法表示，如果线程 thread 在给定的超时时间里没有终止，那么将会从该超时方法中返回。</p> <ul><li>join 方法使用示例
<ul><li>模拟了 3 个线程，每个线程中引用了前一个线程（previous）。</li> <li>在 run 方法中执行<code>previous.join()</code> 表示 previous 线程执行完成后才可以执行 <code>previous.join()</code> 后的逻辑。</li></ul></li></ul> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> previous <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// 每个线程拥有前一个线程的引用，需要等待前一个线程终止，才能从等待中返回</span>
            <span class="token keyword">final</span> <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Domino</span><span class="token punctuation">(</span>previous<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;t-&quot;</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            previous <span class="token operator">=</span> thread<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span>SECONDS<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; terminate.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Domino</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
        <span class="token keyword">private</span> <span class="token class-name">Thread</span> previous<span class="token punctuation">;</span> <span class="token comment">// 当前线程的前一个线程引用</span>

        <span class="token keyword">public</span> <span class="token class-name">Domino</span><span class="token punctuation">(</span><span class="token class-name">Thread</span> previous<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>previous <span class="token operator">=</span> previous<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">final</span> <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">&quot; before .join()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// join 方法调用前逻辑</span>
                previous<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">&quot; after .join()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// join 方法调后前逻辑</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name <span class="token operator">+</span> <span class="token string">&quot; terminate.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/*
    最终打印
    
    t-0 before .join()
    t-2 before .join()
    t-1 before .join()
    main terminate.
    t-0 after .join()
    t-0 terminate.
    t-1 after .join()
    t-1 terminate.
    t-2 after .join()
    t-2 terminate.
     */</span>
</code></pre></div><ul><li>思考：</li></ul> <p>happens-before 语义中的 join 规则？遗忘请复习《内存模型-基础概念》中 happens-before 部分。</p> <ul><li>什么时候用 join？</li></ul> <p>线程之间存在一种等待关系时使用。比如 A 线程必须等 B 线程执行后才可以执行 join 后逻辑。</p> <ul><li>join 怎么实现的？</li></ul> <p>参考 Thread.join 源码分析可知实现使用了 <em>wait</em> 机制，即 <em>《线程等待通知机制》</em></p> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">synchronized</span> <span class="token keyword">void</span> <span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">long</span> millis<span class="token punctuation">)</span>
    <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> base <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> now <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;timeout value is negative&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>millis <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token function">wait</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">isAlive</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">long</span> delay <span class="token operator">=</span> millis <span class="token operator">-</span> now<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>delay <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">wait</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span><span class="token punctuation">;</span>
                now <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> base<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div><h2 id="线程通信"><a href="#线程通信" class="header-anchor">#</a> 线程通信</h2> <ul><li>volatile 和 synchronized 关键字</li> <li>等待通知机制</li> <li>ThreadLocal</li></ul> <h2 id="总结思考"><a href="#总结思考" class="header-anchor">#</a> 总结思考</h2> <ul><li>启动线程为什么调用 start 而不是 run ？</li></ul> <h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <ul><li>并发编程的艺术</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后修改时间:</span> <span class="time">1/3/2020, 8:30:34 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/language/java-concurrency/原子操作类（atomic包）.html" class="prev">原子操作类（atomic包）</a></span> <span class="next"><a href="/language/java-concurrency/线程等待通知机制（wait、notify）.html">线程等待通知机制（wait、notify）</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.64ee1d62.js" defer></script><script src="/assets/js/2.4b0d762e.js" defer></script><script src="/assets/js/100.30452c64.js" defer></script>
  </body>
</html>
